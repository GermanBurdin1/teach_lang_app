<div class="gabarit-page px-3 py-2">
  <h3>📚 Matériel du cours ({{ getLessonDate() | date: 'dd/MM/yyyy' }})</h3>

  <!-- 📄 Textes -->
  <div class="zone text-zone mt-3">
    <h5>📝 Textes</h5>
    <div *ngFor="let t of texts" class="material-item position-relative" 
         (mouseenter)="onHover(getMaterialTitle(t), $event)" 
         (mouseleave)="onLeaveItem()">
      <div *ngIf="isString(t); else objectText" class="item">{{ getDisplayNameSafe(t) }}</div>
      <ng-template #objectText>
        <div class="material-card">
          <h6>{{ getItemTitle(t) || getItemName(t) || 'Texte' }}</h6>
          <p *ngIf="hasItemDescription(t)" class="description">{{ getItemDescription(t) }}</p>
          <div *ngIf="hasItemContent(t)" class="content">{{ getItemContent(t) }}</div>
          <a *ngIf="hasItemUrl(t)" [href]="getItemUrl(t)" target="_blank" class="btn btn-sm btn-outline-primary">Ouvrir</a>
        </div>
      </ng-template>
      
      <!-- Action buttons on hover -->
      <div *ngIf="hoveredItem === getMaterialTitle(t)" class="item-actions" [ngClass]="{
        'drop-above': hoveredPosition === 'above',
        'drop-below': hoveredPosition === 'below'
      }" (mouseenter)="onEnterActions()" (mouseleave)="onLeaveActions()">
        <div class="action-item primary" (click)="lessonStarted && openNotes(getMaterialId(t), getMaterialTitle(t))" [class.disabled]="!lessonStarted" [attr.tabindex]="lessonStarted ? 0 : -1" [attr.aria-disabled]="!lessonStarted">
          📚 Travailler le matériel
        </div>

      </div>
    </div>
  </div>

  <!-- 🎧 Audios -->
  <div class="zone audio-zone mt-3">
    <h5>🔊 Audios</h5>
    <div *ngFor="let a of audios" class="material-item position-relative" 
         (mouseenter)="onHover(getMaterialTitle(a), $event)" 
         (mouseleave)="onLeaveItem()">
      <div *ngIf="isString(a); else objectAudio" class="item">
        <div class="d-flex align-items-center">
          <i class="fas fa-music me-2"></i>
          <span>{{ getDisplayNameSafe(a) }}</span>
        </div>
        <audio *ngIf="isAudioUrlSafe(a)" controls class="w-100 mt-2">
          <source [src]="a" type="audio/mpeg">
          <source [src]="a" type="audio/wav">
          <source [src]="a" type="audio/ogg">
          Votre navigateur ne supporte pas l'audio HTML5.
        </audio>
      </div>
      <ng-template #objectAudio>
        <div class="material-card audio-card">
          <div class="d-flex align-items-center">
            <i class="fas fa-music me-2"></i>
            <div class="flex-grow-1">
              <h6 class="mb-1">{{ getItemTitle(a) || getItemName(a) || 'Audio' }}</h6>
              <p *ngIf="hasItemDescription(a)" class="description mb-0">{{ getItemDescription(a) }}</p>
            </div>
          </div>
          <!-- Проигрыватель для URL -->
          <audio *ngIf="hasItemUrl(a)" controls class="w-100 mt-2">
            <source [src]="getItemUrl(a)" type="audio/mpeg">
            <source [src]="getItemUrl(a)" type="audio/wav">
            <source [src]="getItemUrl(a)" type="audio/ogg">
            Votre navigateur ne supporte pas l'audio HTML5.
          </audio>
          <!-- Проигрыватель для content (если content содержит URL) -->
          <audio *ngIf="!hasItemUrl(a) && hasItemContent(a) && isAudioUrlSafe(a)" controls class="w-100 mt-2">
            <source [src]="getItemContent(a)" type="audio/mpeg">
            <source [src]="getItemContent(a)" type="audio/wav">
            <source [src]="getItemContent(a)" type="audio/ogg">
            Votre navigateur ne supporte pas l'audio HTML5.
          </audio>
          <!-- Текстовое содержимое, если это не URL -->
          <div *ngIf="!hasItemUrl(a) && hasItemContent(a) && !isAudioUrlSafe(a)" class="content">{{ getItemContent(a) }}</div>
        </div>
      </ng-template>
      
      <!-- Action buttons on hover -->
      <div *ngIf="hoveredItem === getMaterialTitle(a)" class="item-actions" [ngClass]="{
        'drop-above': hoveredPosition === 'above',
        'drop-below': hoveredPosition === 'below'
      }" (mouseenter)="onEnterActions()" (mouseleave)="onLeaveActions()">
        <div class="action-item primary" (click)="lessonStarted && openNotes(getMaterialId(a), getMaterialTitle(a))" [class.disabled]="!lessonStarted" [attr.tabindex]="lessonStarted ? 0 : -1" [attr.aria-disabled]="!lessonStarted">
          📚 Travailler le matériel
        </div>

      </div>
    </div>
  </div>

  <!-- 🎬 Vidéos -->
  <div class="zone video-zone mt-3">
    <h5>🎬 Vidéos</h5>
    <div *ngFor="let v of videos" class="material-item position-relative" 
         (mouseenter)="onHover(getMaterialTitle(v), $event)" 
         (mouseleave)="onLeaveItem()">
      <div *ngIf="isString(v); else objectVideo" class="item">
        <div class="d-flex align-items-center">
          <i class="fas fa-video me-2"></i>
          <span>{{ getDisplayNameSafe(v) }}</span>
        </div>
        <video *ngIf="isVideoUrlSafe(v)" controls class="w-100 mt-2">
          <source [src]="v" type="video/mp4">
          <source [src]="v" type="video/webm">
          <source [src]="v" type="video/ogg">
          Votre navigateur ne supporte pas la vidéo HTML5.
        </video>
      </div>
      <ng-template #objectVideo>
        <div class="material-card video-card">
          <div class="d-flex align-items-center">
            <i class="fas fa-video me-2"></i>
            <div class="flex-grow-1">
              <h6 class="mb-1">{{ getItemTitle(v) || getItemName(v) || 'Vidéo' }}</h6>
              <p *ngIf="hasItemDescription(v)" class="description mb-0">{{ getItemDescription(v) }}</p>
            </div>
          </div>
          <!-- Плеер для URL -->
          <video *ngIf="hasItemUrl(v)" controls class="w-100 mt-2">
            <source [src]="getItemUrl(v)" type="video/mp4">
            <source [src]="getItemUrl(v)" type="video/webm">
            <source [src]="getItemUrl(v)" type="video/ogg">
            Votre navigateur ne supporte pas la vidéo HTML5.
          </video>
          <!-- Плеер для content (если content содержит URL видео) -->
          <video *ngIf="!hasItemUrl(v) && hasItemContent(v) && isVideoUrlSafe(v)" controls class="w-100 mt-2">
            <source [src]="getItemContent(v)" type="video/mp4">
            <source [src]="getItemContent(v)" type="video/webm">
            <source [src]="getItemContent(v)" type="video/ogg">
            Votre navigateur ne supporte pas la vidéo HTML5.
          </video>
          <!-- Текстовое содержимое, если это не URL -->
          <div *ngIf="!hasItemUrl(v) && hasItemContent(v) && !isVideoUrlSafe(v)" class="content">{{ getItemContent(v) }}</div>
        </div>
      </ng-template>
      
      <!-- Action buttons on hover -->
      <div *ngIf="hoveredItem === getMaterialTitle(v)" class="item-actions" [ngClass]="{
        'drop-above': hoveredPosition === 'above',
        'drop-below': hoveredPosition === 'below'
      }" (mouseenter)="onEnterActions()" (mouseleave)="onLeaveActions()">
        <div class="action-item primary" (click)="lessonStarted && openNotes(getMaterialId(v), getMaterialTitle(v))" [class.disabled]="!lessonStarted" [attr.tabindex]="lessonStarted ? 0 : -1" [attr.aria-disabled]="!lessonStarted">
          📚 Travailler le matériel
        </div>

      </div>
    </div>
  </div>
</div>
