<div class="add-course-container">
  <!-- Header -->
  <div class="course-header">
    <h1 class="page-title">
      <i class="fas fa-graduation-cap"></i>
      Mes cours
    </h1>
    <p class="page-subtitle">Cr√©ez et g√©rez vos cours avec des mat√©riaux p√©dagogiques</p>
  </div>

  <!-- Add Course Button (if no course) -->
  <div *ngIf="!courseId && !showCreateCourseForm" class="add-course-button-section">
    <button 
      class="btn btn-primary btn-lg add-course-btn"
      (click)="showCreateCourseForm = true">
      <i class="fas fa-plus"></i>
      Ajouter un cours
    </button>
  </div>

  <!-- Course Creation Form -->
  <div *ngIf="showCreateCourseForm && !courseId" class="course-form-section">
    <div class="form-card">
      <h2>
        <i class="fas fa-info-circle"></i>
        Informations du cours
      </h2>
      
      <div class="form-group">
        <label>Titre du cours *</label>
        <input 
          type="text" 
          [(ngModel)]="courseTitle"
          placeholder="Ex: Cours DELF B1"
          class="form-control">
      </div>

      <div class="form-group">
        <label>Description</label>
        <textarea 
          [(ngModel)]="courseDescription"
          (ngModelChange)="markAsChanged()"
          placeholder="Description du cours..."
          class="form-control"
          rows="4"></textarea>
      </div>

      <div class="form-group">
        <label>Niveau</label>
        <select [(ngModel)]="courseLevel" (ngModelChange)="markAsChanged()" class="form-control">
          <option value="">S√©lectionner un niveau</option>
          <option value="A1">A1</option>
          <option value="A2">A2</option>
          <option value="B1">B1</option>
          <option value="B2">B2</option>
          <option value="C1">C1</option>
          <option value="C2">C2</option>
        </select>
      </div>

      <!-- Cover Image -->
      <div class="form-group">
        <label>Image de couverture</label>
        <div class="cover-image-container">
          <div *ngIf="coverImage" class="cover-image-preview">
            <img [src]="coverImage" alt="Cover" class="cover-image">
            <button type="button" class="remove-cover-btn" (click)="removeCoverImage()" title="Supprimer">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div *ngIf="!coverImage" class="cover-image-upload">
            <input 
              type="file" 
              id="coverImageInput"
              accept="image/*"
              (change)="onCoverImageSelected($event)"
              class="file-input">
            <label for="coverImageInput" class="cover-upload-label">
              <i class="fas fa-image"></i>
              <span>Choisir une image de couverture</span>
            </label>
          </div>
          <button 
            *ngIf="coverImageFile && courseId"
            type="button"
            class="btn btn-sm btn-primary mt-2"
            (click)="uploadCoverImage()"
            [disabled]="uploadingCover">
            <i class="fas fa-upload"></i>
            {{ uploadingCover ? 'Upload en cours...' : 'Uploader l\'image' }}
          </button>
        </div>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="isPublished" (ngModelChange)="markAsChanged()">
          Publier le cours imm√©diatement
        </label>
      </div>

      <div class="form-actions">
        <button 
          class="btn btn-primary btn-lg"
          (click)="createCourse()"
          [disabled]="!courseTitle.trim()">
          <i class="fas fa-check"></i>
          Cr√©er le cours
        </button>
        <button 
          class="btn btn-secondary btn-lg"
          (click)="showCreateCourseForm = false; courseTitle = ''; courseDescription = ''; courseLevel = ''; isPublished = false;">
          Annuler
        </button>
      </div>
    </div>
  </div>

  <!-- Add Another Course Button (outside course card) -->
  <div *ngIf="courseId" class="add-another-course-section">
    <button 
      class="btn btn-secondary btn-lg"
      (click)="showCreateCourseForm = true; isCourseCardExpanded = false">
      <i class="fas fa-plus"></i>
      Ajouter un autre cours
    </button>
  </div>

  <!-- Course Card (shown after course creation) -->
  <div *ngIf="courseId" class="course-card-section">
    <div class="course-card" [class.expanded]="isCourseCardExpanded">
      <div class="course-card-header" (click)="toggleCourseCard()">
        <div class="course-title-section">
          <h2>
            <i class="fas fa-book"></i>
            {{ courseTitle }}
          </h2>
          <div class="course-meta">
            <span *ngIf="courseLevel" class="course-level">{{ courseLevel }}</span>
            <span class="course-status" [class.published]="isPublished">
              {{ isPublished ? 'Publi√©' : 'Brouillon' }}
            </span>
          </div>
          <div class="course-lessons-summary" *ngIf="getLessonsSummary().length > 0">
            <span *ngFor="let summary of getLessonsSummary(); let last = last" class="lesson-summary-item">
              {{ summary.section }} - {{ summary.count }} {{ summary.count === 1 ? 'le√ßon' : 'le√ßons' }}<span *ngIf="!last">, </span>
            </span>
          </div>
        </div>
        <div class="course-actions-header" (click)="$event.stopPropagation()">
          <button 
            *ngIf="hasUnsavedChanges"
            class="btn btn-success btn-icon"
            (click)="updateCourse()"
            [disabled]="!courseTitle.trim()"
            title="Enregistrer les modifications">
            <i class="fas fa-save"></i>
          </button>
          <button 
            class="btn btn-secondary btn-icon"
            (click)="showCreateCourseForm = !showCreateCourseForm"
            title="Modifier les informations du cours">
            <i class="fas fa-edit"></i>
          </button>
          <button 
            class="btn btn-danger btn-icon"
            (click)="deleteCourse()"
            title="Supprimer le cours">
            <i class="fas fa-trash"></i>
          </button>
          <i class="fas expand-icon" 
             [class.fa-chevron-down]="!isCourseCardExpanded" 
             [class.fa-chevron-up]="isCourseCardExpanded"></i>
        </div>
      </div>

      <div *ngIf="isCourseCardExpanded" class="course-card-content">
        <div *ngIf="courseDescription" class="course-description">
          <p>{{ courseDescription }}</p>
        </div>

        <div *ngIf="coverImage" class="course-cover">
          <img [src]="coverImage" alt="Cover" class="cover-image-display">
        </div>

        <!-- Course Edit Form (collapsible) -->
        <div class="course-edit-section">
          <div *ngIf="showCreateCourseForm" class="course-edit-form">
          <div class="form-group">
            <label>Titre du cours *</label>
            <input 
              type="text" 
              [(ngModel)]="courseTitle"
              (ngModelChange)="markAsChanged()"
              placeholder="Ex: Cours DELF B1"
              class="form-control">
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea 
              [(ngModel)]="courseDescription"
              (ngModelChange)="markAsChanged()"
              placeholder="Description du cours..."
              class="form-control"
              rows="4"></textarea>
          </div>

          <div class="form-group">
            <label>Niveau</label>
            <select [(ngModel)]="courseLevel" (ngModelChange)="markAsChanged()" class="form-control">
              <option value="">S√©lectionner un niveau</option>
              <option value="A1">A1</option>
              <option value="A2">A2</option>
              <option value="B1">B1</option>
              <option value="B2">B2</option>
              <option value="C1">C1</option>
              <option value="C2">C2</option>
            </select>
          </div>

          <!-- Cover Image -->
          <div class="form-group">
            <label>Image de couverture</label>
            <div class="cover-image-container">
              <div *ngIf="coverImage" class="cover-image-preview">
                <img [src]="coverImage" alt="Cover" class="cover-image">
                <button type="button" class="remove-cover-btn" (click)="removeCoverImage()" title="Supprimer">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div *ngIf="!coverImage" class="cover-image-upload">
                <input 
                  type="file" 
                  id="coverImageInput"
                  accept="image/*"
                  (change)="onCoverImageSelected($event)"
                  class="file-input">
                <label for="coverImageInput" class="cover-upload-label">
                  <i class="fas fa-image"></i>
                  <span>Choisir une image de couverture</span>
                </label>
              </div>
              <button 
                *ngIf="coverImageFile"
                type="button"
                class="btn btn-sm btn-primary mt-2"
                (click)="uploadCoverImage()"
                [disabled]="uploadingCover">
                <i class="fas fa-upload"></i>
                {{ uploadingCover ? 'Upload en cours...' : 'Uploader l\'image' }}
              </button>
            </div>
          </div>

          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="isPublished" (ngModelChange)="markAsChanged()">
              Publier le cours imm√©diatement
            </label>
          </div>
        </div>
      </div>

      <!-- Materials Section (inside course card, expandable) -->
      <div class="materials-section" [class.expanded]="isMaterialsSectionExpanded">
        <div class="materials-section-header" (click)="isMaterialsSectionExpanded = !isMaterialsSectionExpanded">
          <h2>
            <i class="fas fa-folder-open"></i>
            Mat√©riaux du cours
          </h2>
          <i class="fas expand-icon" 
             [class.fa-chevron-down]="!isMaterialsSectionExpanded" 
             [class.fa-chevron-up]="isMaterialsSectionExpanded"></i>
        </div>

        <div *ngIf="isMaterialsSectionExpanded" class="materials-section-content">
          <!-- Warning if no sections -->
    <div *ngIf="sections.length === 0" class="no-sections-warning">
      <div class="warning-content">
        <i class="fas fa-exclamation-triangle"></i>
        <div>
          <h4>Ajoutez d'abord une section</h4>
          <p>Vous devez cr√©er au moins une section avant de pouvoir ajouter des mat√©riaux au cours.</p>
        </div>
      </div>
    </div>

    <!-- Materials without section (legacy) -->
    <div *ngIf="getMaterialsBySection(null).length > 0 || getMaterialsWithoutSection().length > 0" class="materials-list">
      <h3>Mat√©riaux sans section ({{ getMaterialsWithoutSection().length }})</h3>
      <div class="materials-grid">
        <div *ngFor="let material of getMaterialsWithoutSection()" class="material-item">
          <div class="material-icon">
            <i [class]="getMaterialTypeIcon(getMaterialTypeFromMime(material.mimetype))"></i>
          </div>
          <div class="material-info">
            <h4>{{ material.filename }}</h4>
            <p *ngIf="material.description" class="material-desc">{{ material.description }}</p>
          </div>
          <div class="material-actions">
            <button 
              class="btn btn-sm btn-danger"
              (click)="deleteMaterial(material)"
              title="Supprimer">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Sections Management -->
    <div class="sections-management">
      <div class="sections-header">
        <h3>
          <i class="fas fa-list"></i>
          Sections du cours
        </h3>
        <button 
          class="btn btn-primary btn-lg add-section-btn"
          (click)="showAddSectionDropdown = !showAddSectionDropdown">
          <i class="fas fa-plus-circle"></i>
          Ajouter une section
        </button>
      </div>

      <!-- Section Dropdown -->
      <div *ngIf="showAddSectionDropdown" class="add-section-dropdown">
        <select class="form-select" (change)="addSection($event); showAddSectionDropdown = false">
          <option value="" selected disabled>Choisir une section</option>
          <option *ngFor="let option of sectionsOptions" [value]="option">{{ option }}</option>
        </select>
      </div>
      
      <div class="add-section-controls" *ngIf="sections.length > 0">

        <!-- Display sections -->
        <div *ngFor="let section of sections; let i = index" class="section-item" 
             [attr.data-section-index]="i" 
             (mouseover)="hoveredSection = section"
             (mouseleave)="hoveredSection = null">
          <div class="section-item-header">
            <div class="section-name-wrapper">
              <button 
                class="btn btn-link section-toggle-btn"
                (click)="toggleSection(section)"
                *ngIf="getMaterialsBySection(section).length > 0"
                title="Afficher/Masquer les mat√©riaux">
                <i class="fas" 
                   [class.fa-chevron-down]="!isSectionExpanded(section)" 
                   [class.fa-chevron-up]="isSectionExpanded(section)"></i>
              </button>
              <span class="fw-bold section-name">{{ section }}</span>
              <span class="section-materials-count" *ngIf="getMaterialsBySection(section).length > 0">
                ({{ getMaterialsBySection(section).length }})
              </span>
            </div>
            <div class="section-actions">
              <button 
                class="btn btn-link btn-sm btn-subsection"
                (click)="addSubSection(section)"
                title="Ajouter une sous-section">
                <i class="fas fa-plus-circle"></i>
                Sous-section
              </button>
              <button 
                class="btn btn-link btn-sm btn-lesson"
                (click)="addLesson(section)">
                <i class="fas fa-plus"></i>
                Le√ßon
              </button>
              <button 
                class="btn btn-danger btn-sm btn-delete"
                (click)="removeSection(section)"
                title="Supprimer la section">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          
          <!-- Materials in this section (collapsible) -->
          <div class="section-materials-wrapper" 
               [class.expanded]="isSectionExpanded(section)"
               *ngIf="getMaterialsBySection(section).length > 0">
            <div class="section-materials">
              <div class="materials-grid">
                <div *ngFor="let material of getMaterialsBySection(section)" class="material-item">
                  <div class="material-icon">
                    <i [class]="getMaterialTypeIcon(getMaterialTypeFromMime(material.mimetype))"></i>
                  </div>
                  <div class="material-info">
                    <h4>{{ material.filename }}</h4>
                    <p *ngIf="material.description" class="material-desc">{{ material.description }}</p>
                  </div>
                  <div class="material-actions">
                    <button 
                      class="btn btn-sm btn-danger"
                      (click)="deleteMaterial(material)"
                      title="Supprimer">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Add Sub-section Input -->
          <div class="add-subsection-input-container" *ngIf="showAddSubSectionInput[section]">
            <div class="add-subsection-input-wrapper">
              <input 
                type="text"
                id="subSectionInput_{{ section }}"
                [(ngModel)]="newSubSectionName[section]"
                (keyup.enter)="confirmAddSubSection(section)"
                (keyup.escape)="cancelAddSubSection(section)"
                placeholder="Nom de la sous-section"
                class="form-control form-control-sm add-subsection-input">
              <div class="add-subsection-actions">
                <button 
                  class="btn btn-sm btn-success"
                  (click)="confirmAddSubSection(section)"
                  title="Ajouter">
                  <i class="fas fa-check"></i>
                </button>
                <button 
                  class="btn btn-sm btn-secondary"
                  (click)="cancelAddSubSection(section)"
                  title="Annuler">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Sub-sections -->
          <div class="subsections-container" *ngIf="subSections[section] && subSections[section].length > 0">
            <div *ngFor="let subSection of subSections[section]; let subIndex = index" 
                 class="subsection-item"
                 [attr.data-subsection-index]="subIndex"
                 (dragover)="onLessonDragOver($event)"
                 (drop)="onDropLesson($event, section, subSection)"
                 (dragenter)="onLessonDragEnter($event)"
                 (dragleave)="onLessonDragLeave($event)">
              <div class="subsection-header">
                <span class="subsection-name">
                  <i class="fas fa-folder"></i>
                  {{ subIndex + 1 }}. {{ subSection }}
                </span>
                <div class="subsection-actions">
                  <button 
                    class="btn btn-link btn-xs btn-lesson-subsection"
                    (click)="addLesson(section, subSection)"
                    title="Ajouter une le√ßon">
                    <i class="fas fa-plus"></i>
                    Le√ßon
                  </button>
                  <button 
                    class="btn btn-xs btn-danger btn-delete-subsection"
                    (click)="removeSubSection(section, subSection)"
                    title="Supprimer la sous-section">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
              
              <!-- Lessons in this sub-section -->
              <div class="lessons-in-subsection" *ngIf="getLessonsInSubSection(section, subSection).length > 0">
                <div *ngFor="let lesson of getLessonsInSubSection(section, subSection); let lessonIndex = index" 
                     class="lesson-item lesson-in-subsection"
                     draggable="true"
                     (dragstart)="onDragStart($event, section, subSection, lesson)"
                     (dragend)="onDragEnd($event)">
                  <div class="lesson-header" (click)="toggleLesson(section + '_' + subSection + '_' + lesson)">
                    <div class="lesson-name-wrapper">
                      <span class="lesson-name">
                        <i class="fas fa-book-open"></i>
                        {{ lesson }}
                      </span>
                    </div>
                    <div class="lesson-actions" (click)="$event.stopPropagation()">
                      <button 
                        class="btn btn-link btn-xs btn-preview-lesson"
                        (click)="openLessonPreview(section, lesson, subSection)"
                        title="G√©rer la le√ßon">
                        <i class="fas fa-cog"></i>
                      </button>
                      <button 
                        class="btn btn-xs btn-danger btn-delete-lesson"
                        (click)="removeLesson(section, lesson, subSection)"
                        title="Supprimer la le√ßon">
                        <i class="fas fa-trash"></i>
                      </button>
                      <i class="fas expand-icon" 
                         [class.fa-chevron-down]="!isLessonExpanded(section + '_' + subSection + '_' + lesson)" 
                         [class.fa-chevron-up]="isLessonExpanded(section + '_' + subSection + '_' + lesson)"></i>
                    </div>
                  </div>
                  
                  <!-- Lesson info (description, materials list, duration) -->
                  <div class="lesson-info-wrapper" 
                       [class.expanded]="isLessonExpanded(section + '_' + subSection + '_' + lesson)">
                    <div class="lesson-info-content">
                      <!-- –û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞ -->
                      <div class="lesson-description-info" *ngIf="getLessonDescription(section, subSection, lesson)">
                        <i class="fas fa-align-left"></i>
                        <span>{{ getLessonDescription(section, subSection, lesson) }}</span>
                      </div>
                      
                      <!-- –°–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
                      <div class="lesson-materials-info" *ngIf="getMaterialsByLesson(lesson).length > 0">
                        <div class="materials-list-compact">
                          <span class="materials-label">
                            <i class="fas fa-file-alt"></i>
                            Mat√©riaux:
                          </span>
                          <span class="materials-names">
                            <span *ngFor="let material of getMaterialsByLesson(lesson); let last = last">
                              {{ material.filename }}<span *ngIf="!last">, </span>
                            </span>
                          </span>
                        </div>
                        
                        <!-- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
                        <div class="lesson-duration" *ngIf="getLessonDuration(section, subSection, lesson) > 0">
                          <i class="fas fa-clock"></i>
                          <span>{{ formatDuration(getLessonDuration(section, subSection, lesson)) }}</span>
                        </div>
                      </div>
                      
                      <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
                      <div class="lesson-info-empty" *ngIf="getMaterialsByLesson(lesson).length === 0 && !getLessonDescription(section, subSection, lesson)">
                        <p class="text-muted"><i class="fas fa-info-circle"></i> Aucun mat√©riau dans cette le√ßon</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Lessons (not in sub-sections) -->
          <div class="lessons-container" 
               (dragover)="onSectionDragOver($event)"
               (drop)="onDropLessonToSection($event, section)"
               (dragenter)="onSectionDragEnter($event)"
               (dragleave)="onSectionDragLeave($event)"
               [class.has-lessons]="getLessonsInSection(section).length > 0"
               [class.empty-drop-zone]="getLessonsInSection(section).length === 0">
            <div *ngIf="getLessonsInSection(section).length === 0" class="empty-lessons-hint">
              <p class="text-muted"><i class="fas fa-info-circle"></i> Glissez-d√©posez les le√ßons ici pour les d√©placer au niveau de la section</p>
            </div>
            <div *ngFor="let lesson of getLessonsInSection(section); let lessonIndex = index" 
                 class="lesson-item"
                 [attr.data-lesson-index]="lessonIndex"
                 draggable="true"
                 (dragstart)="onDragStart($event, section, null, lesson)"
                 (dragend)="onDragEnd($event)">
              <div class="lesson-header" (click)="toggleLesson(section + '_' + lesson)">
                <div class="lesson-name-wrapper">
                  <span class="lesson-name">
                    <i class="fas fa-book-open"></i>
                    {{ lesson }}
                  </span>
                </div>
                <div class="lesson-actions" (click)="$event.stopPropagation()">
                  <button 
                    class="btn btn-link btn-xs btn-preview-lesson"
                    (click)="openLessonPreview(section, lesson)"
                    title="G√©rer la le√ßon">
                    <i class="fas fa-cog"></i>
                  </button>
                  <button 
                    class="btn btn-xs btn-danger btn-delete-lesson"
                    (click)="removeLesson(section, lesson)"
                    title="Supprimer la le√ßon">
                    <i class="fas fa-trash"></i>
                  </button>
                  <i class="fas expand-icon" 
                     [class.fa-chevron-down]="!isLessonExpanded(section + '_' + lesson)" 
                     [class.fa-chevron-up]="isLessonExpanded(section + '_' + lesson)"></i>
                </div>
              </div>
              
              <!-- Lesson info (description, materials list, duration) -->
              <div class="lesson-info-wrapper" 
                   [class.expanded]="isLessonExpanded(section + '_' + lesson)">
                <div class="lesson-info-content">
                  <!-- –û–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–∫–∞ -->
                  <div class="lesson-description-info" *ngIf="getLessonDescription(section, null, lesson)">
                    <i class="fas fa-align-left"></i>
                    <span>{{ getLessonDescription(section, null, lesson) }}</span>
                  </div>
                  
                  <!-- –°–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
                  <div class="lesson-materials-info" *ngIf="getMaterialsByLesson(lesson).length > 0">
                    <div class="materials-list-compact">
                      <span class="materials-label">
                        <i class="fas fa-file-alt"></i>
                        Mat√©riaux:
                      </span>
                      <span class="materials-names">
                        <span *ngFor="let material of getMaterialsByLesson(lesson); let last = last">
                          {{ material.filename }}<span *ngIf="!last">, </span>
                        </span>
                      </span>
                    </div>
                    
                    <!-- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ -->
                    <div class="lesson-duration" *ngIf="getLessonDuration(section, null, lesson) > 0">
                      <i class="fas fa-clock"></i>
                      <span>{{ formatDuration(getLessonDuration(section, null, lesson)) }}</span>
                    </div>
                  </div>
                  
                  <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
                  <div class="lesson-info-empty" *ngIf="getMaterialsByLesson(lesson).length === 0 && !getLessonDescription(section, null, lesson)">
                    <p class="text-muted"><i class="fas fa-info-circle"></i> Aucun mat√©riau dans cette le√ßon</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="section-materials-empty" *ngIf="getMaterialsBySection(section).length === 0 && (!lessons[section] || lessons[section].length === 0)">
            <p class="text-muted"><i class="fas fa-info-circle"></i> Aucun mat√©riau dans cette section</p>
          </div>
        </div>
      </div>

          <!-- Create Material Form Modal -->
          <div *ngIf="showCreateMaterialForm" class="create-form-modal">
      <div class="modal-overlay" (click)="clearMaterialForm()"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>
            <i class="fas fa-plus-circle"></i>
            Ajouter un Mat√©riau
          </h3>
          <button class="close-btn" (click)="clearMaterialForm()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <!-- Tabs for new/existing materials -->
        <div class="modal-tabs">
          <button 
            class="tab-btn"
            [class.active]="!showExistingMaterials"
            (click)="showExistingMaterials = false">
            <i class="fas fa-plus"></i>
            Nouveau mat√©riau
          </button>
          <button 
            class="tab-btn"
            [class.active]="showExistingMaterials"
            (click)="toggleExistingMaterials()">
            <i class="fas fa-folder-open"></i>
            Mat√©riaux existants
            <span *ngIf="trainerMaterials.length > 0" class="badge">{{ trainerMaterials.length }}</span>
          </button>
        </div>
        
        <div class="modal-body">
          <!-- Existing Materials List -->
          <div *ngIf="showExistingMaterials" class="existing-materials-list">
            <div *ngIf="loadingTrainerMaterials" class="loading-message">
              <i class="fas fa-spinner fa-spin"></i>
              Chargement des mat√©riaux...
            </div>
            
            <div *ngIf="!loadingTrainerMaterials && trainerMaterials.length === 0" class="no-materials-message">
              <p><i class="fas fa-info-circle"></i> Vous n'avez pas encore de mat√©riaux dans Entra√Ænement.</p>
              <p>Cr√©ez d'abord des mat√©riaux dans la section Entra√Ænement.</p>
            </div>

            <div *ngIf="!loadingTrainerMaterials && trainerMaterials.length > 0" class="materials-grid-mini">
              <div 
                *ngFor="let material of trainerMaterials"
                class="material-card-mini"
                (click)="addExistingMaterialToCourse(material)">
                <div class="material-header-mini">
                  <div class="material-type-mini">
                    <i [class]="getMaterialTypeIcon(material.type)"></i>
                    <span>{{ material.type.toUpperCase() }}</span>
                  </div>
                </div>
                <div class="material-body-mini">
                  <h5>{{ material.title }}</h5>
                  <p *ngIf="material.description" class="material-description-mini">
                    {{ material.description }}
                  </p>
                  <div *ngIf="material.tags && material.tags.length > 0" class="material-tags-mini">
                    <span *ngFor="let tag of material.tags" class="tag-mini">{{ tag }}</span>
                  </div>
                </div>
                <div class="material-footer-mini">
                  <button class="btn btn-sm btn-primary">
                    <i class="fas fa-plus"></i>
                    Ajouter au cours
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Create New Material Form -->
          <div *ngIf="!showExistingMaterials">
          <div class="form-group">
            <label>Titre du mat√©riau *</label>
            <input 
              type="text" 
              [(ngModel)]="newMaterial.title"
              placeholder="Ex: Grammaire - Le subjonctif"
              class="form-control">
          </div>

          <div class="form-group">
            <label>Type de mat√©riau</label>
            <select [(ngModel)]="newMaterial.type" class="form-control">
              <option value="text">üìÑ Texte</option>
              <option value="audio">üéß Audio</option>
              <option value="video">üé¨ Vid√©o</option>
              <option value="pdf">üìã PDF</option>
              <option value="image">üñºÔ∏è Image</option>
            </select>
          </div>

          <!-- File Upload for specific types -->
          <div class="form-group" *ngIf="needsFileUpload()">
            <label>Fichier √† t√©l√©charger</label>
            <div class="file-upload-container" 
                 (dragover)="onDragOver($event)" 
                 (dragleave)="onDragLeave($event)"
                 (drop)="onDrop($event)"
                 [class.drag-over]="isDragOver">
              <input 
                type="file" 
                id="materialFile"
                (change)="onFileSelected($event)"
                [accept]="getAcceptedFileTypes()"
                class="file-input">
              <label for="materialFile" class="file-upload-label">
                <div class="upload-content">
                  <i class="fas fa-cloud-upload-alt"></i>
                  <div class="upload-text">
                    <span *ngIf="!selectedFile" class="upload-main">Choisir un fichier</span>
                    <span *ngIf="selectedFile" class="upload-main">{{ selectedFile.name }}</span>
                    <small class="upload-hint">ou glissez-d√©posez ici</small>
                  </div>
                </div>
              </label>
            </div>
            
            <!-- File Preview -->
            <div *ngIf="selectedFile && filePreview" class="file-preview">
              <div class="preview-header">
                <h5>Aper√ßu du fichier</h5>
                <button type="button" class="remove-file-btn" (click)="removeSelectedFile()">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <div class="preview-content">
                <img *ngIf="newMaterial.type === 'image'" [src]="filePreview" alt="Aper√ßu" class="image-preview">
                <div *ngIf="newMaterial.type === 'pdf'" class="file-info">
                  <i class="fas fa-file-pdf"></i>
                  <span>{{ selectedFile.name }}</span>
                  <small>{{ formatFileSize(selectedFile.size) }}</small>
                </div>
                <div *ngIf="newMaterial.type === 'audio'" class="file-info">
                  <i class="fas fa-music"></i>
                  <span>{{ selectedFile.name }}</span>
                  <small>{{ formatFileSize(selectedFile.size) }}</small>
                </div>
                <div *ngIf="newMaterial.type === 'video'" class="file-info">
                  <i class="fas fa-video"></i>
                  <span>{{ selectedFile.name }}</span>
                  <small>{{ formatFileSize(selectedFile.size) }}</small>
                </div>
              </div>
            </div>
          </div>

          <!-- Text content for text type -->
          <div class="form-group" *ngIf="newMaterial.type === 'text'">
            <label>Contenu du texte *</label>
            <textarea 
              [(ngModel)]="newMaterial.content"
              placeholder="Saisissez le contenu du texte..."
              class="form-control"
              rows="6"></textarea>
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea 
              [(ngModel)]="newMaterial.description"
              placeholder="Description du mat√©riau..."
              class="form-control"
              rows="3"></textarea>
          </div>

          <div class="form-group">
            <label>Tag (optionnel)</label>
            <input 
              type="text" 
              [(ngModel)]="newMaterial.tag"
              placeholder="Ex: grammaire, vocabulaire..."
              class="form-control">
          </div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="clearMaterialForm()">
            Annuler
          </button>
          <button 
            *ngIf="!showExistingMaterials"
            class="btn btn-primary"
            (click)="createMaterial()"
            [disabled]="!newMaterial.title.trim() || sections.length === 0 || (!selectedSection && !selectedLesson) || (needsFileUpload() && !selectedFile) || (newMaterial.type === 'text' && !newMaterial.content.trim())">
            <i class="fas fa-check"></i>
            Cr√©er
          </button>
        </div>
      </div>
    </div>

    <!-- Upload Modal (for sections) -->
    <div *ngIf="isUploadModalOpen" class="modal fade show d-block" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Ajouter m√©dia</h5>
            <button type="button" class="btn-close" (click)="closeUploadModal()"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="mediaName" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ–¥–∏–∞*</label>
                <input type="text" class="form-control" id="mediaName" [(ngModel)]="newMaterial.title" name="mediaTitle" required>
              </div>

              <div class="mb-3">
                <label for="mediaTag" class="form-label">–¢–µ–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="text" class="form-control" id="mediaTag" [(ngModel)]="newMaterial.tag" name="mediaTag">
              </div>

              <div class="mb-3">
                <label for="mediaDescription" class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <textarea class="form-control" id="mediaDescription" [(ngModel)]="newMaterial.description" name="mediaDescription"></textarea>
              </div>

              <div class="mb-3">
                <label for="coverImage" class="form-label">–û–±–ª–æ–∂–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="file" class="form-control" id="coverImage" (change)="selectCoverImage($event)">
              </div>

              <div class="mb-3">
                <label for="mediaFile" class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª*</label>
                <input type="file" class="form-control" id="mediaFile" (change)="selectFile($event)" required>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeUploadModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="button" class="btn btn-primary" (click)="confirmUpload()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
          </div>
        </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

