<div class="material-preview-modal">
  <div class="modal-header">
    <h2 class="modal-title">
      <mat-icon>{{ getMaterialTypeFromMime(material.mimetype) === 'audio' ? 'audiotrack' : 
                   getMaterialTypeFromMime(material.mimetype) === 'video' ? 'videocam' : 
                   getMaterialTypeFromMime(material.mimetype) === 'image' ? 'image' : 
                   getMaterialTypeFromMime(material.mimetype) === 'pdf' ? 'picture_as_pdf' : 
                   getMaterialTypeFromMime(material.mimetype) === 'drill_grid' ? 'grid_on' : 
                   'insert_drive_file' }}</mat-icon>
      {{ material.filename }}
    </h2>
    <button mat-icon-button (click)="close()" class="close-button" aria-label="Fermer">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <div class="modal-content">
    <!-- Аудио -->
    <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'audio'" class="audio-preview">
      <audio controls [src]="getFileUrl(material.url)" class="audio-player">
        Votre navigateur ne supporte pas l'élément audio.
      </audio>
    </div>
    
    <!-- Видео -->
    <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'video'" class="video-preview">
      <video controls [src]="getFileUrl(material.url)" class="video-player">
        Votre navigateur ne supporte pas l'élément vidéo.
      </video>
    </div>
    
    <!-- Изображение -->
    <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'image'" class="image-preview">
      <img [src]="getFileUrl(material.url)" [alt]="material.filename" class="material-image">
    </div>
    
    <!-- PDF -->
    <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'pdf'" class="pdf-preview">
      <iframe [src]="getFileUrl(material.url)" class="pdf-viewer" frameborder="0"></iframe>
      <div class="pdf-actions">
        <a [href]="getFileUrl(material.url)" target="_blank" class="btn btn-primary">
          <mat-icon>open_in_new</mat-icon>
          Ouvrir dans un nouvel onglet
        </a>
      </div>
    </div>
    
    <!-- Текст -->
    <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'text'" class="text-preview">
      <p class="text-content">{{ material.description || 'Contenu texte' }}</p>
    </div>

    <!-- Drill-grid -->
    <div *ngIf="isDrillGrid(material)" class="drill-grid-preview">
      <div class="drill-grid-header">
        <h5>
          <mat-icon>grid_on</mat-icon>
          {{ material.filename }}
        </h5>
        <p *ngIf="material.description" class="drill-grid-description">{{ material.description }}</p>
        <button 
          class="btn btn-primary"
          (click)="openDrillGridFullscreen(material)"
          title="Ouvrir en mode plein écran">
          <mat-icon>fullscreen</mat-icon>
          Ouvrir en plein écran
        </button>
      </div>
      <div class="drill-grid-table-container" *ngIf="getDrillGridData(material)">
        <div class="drill-table">
          <div class="drill-header-row">
            <div class="drill-cell header-cell"></div>
            <div class="drill-cell header-cell" *ngFor="let col of getDrillGridColumnsArray(material)">
              {{ col || 'Colonne' }}
            </div>
          </div>
          <div class="drill-row" *ngFor="let row of getDrillGridRowsArray(material); let rowIdx = index">
            <div class="drill-cell header-cell">{{ row || 'Ligne' }}</div>
            <div class="drill-cell" *ngFor="let col of getDrillGridColumnsArray(material); let colIdx = index">
              {{ getDrillGridCellContent(material, rowIdx, colIdx) }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Другие файлы -->
    <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'file'" class="file-preview">
      <mat-icon class="file-icon">insert_drive_file</mat-icon>
      <p class="file-name">{{ material.filename }}</p>
      <a [href]="getFileUrl(material.url)" target="_blank" class="btn btn-primary">
        <mat-icon>download</mat-icon>
        Télécharger le fichier
      </a>
    </div>
  </div>

  <div class="modal-actions">
    <button mat-button (click)="close()">Fermer</button>
  </div>
</div>

