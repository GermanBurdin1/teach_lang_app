<div class="lesson-preview-modal">
  <div class="modal-header">
    <h2 class="modal-title">
      <i class="fas fa-book-open"></i>
      {{ data.lessonName }}
    </h2>
    <div class="header-actions">
      <button 
        mat-icon-button 
        (click)="toggleFullscreen()" 
        class="restore-button" 
        [title]="isFullscreen ? 'Restaurer' : 'Plein écran'"
        aria-label="Toggle fullscreen">
        <i [class]="isFullscreen ? 'fas fa-compress' : 'fas fa-expand'"></i>
      </button>
      <button mat-icon-button (click)="close()" class="close-button" aria-label="Fermer">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>

  <div class="modal-content">
    <!-- Описание урока -->
    <div class="lesson-description-section">
      <div class="section-header">
        <h3>
          <i class="fas fa-align-left"></i>
          Description de la leçon
        </h3>
      </div>
      
      <div class="description-edit">
        <textarea 
          [(ngModel)]="lessonDescription"
          (blur)="saveDescription()"
          class="form-control description-textarea"
          rows="4"
          placeholder="Entrez la description de la leçon..."></textarea>
      </div>
    </div>

    <!-- Материалы урока -->
    <div class="lesson-materials-section">
      <div class="section-header">
        <h3>
          <i class="fas fa-file-alt"></i>
          Matériaux ({{ regularMaterials.length }})
        </h3>
        <button 
          class="btn btn-sm btn-primary"
          (click)="openAddMaterial()"
          title="Ajouter un matériau">
          <i class="fas fa-plus"></i>
          Ajouter un matériau
        </button>
      </div>
      
      <div *ngIf="regularMaterials.length > 0" class="materials-list">
        <div *ngFor="let material of regularMaterials" class="material-item">
          <div class="material-header-row">
            <div class="material-icon">
              <i [class]="getMaterialTypeIcon(material.mimetype)"></i>
            </div>
            <div class="material-info">
              <h4>{{ material.filename }}</h4>
              <p *ngIf="material.description" class="material-desc">{{ material.description }}</p>
            </div>
            <div class="material-actions">
              <button 
                class="btn btn-xs btn-link"
                (click)="openAddHomework(material.id)"
                title="Ajouter un devoir à ce matériau">
                <i class="fas fa-plus"></i>
                Devoir
              </button>
            </div>
          </div>
          <div class="material-preview">
            <!-- Аудио -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'audio'" class="audio-preview">
              <audio controls [src]="getFileUrl(material.url)" class="audio-player">
                Votre navigateur ne supporte pas l'élément audio.
              </audio>
            </div>
            
            <!-- Видео -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'video'" class="video-preview">
              <video controls [src]="getFileUrl(material.url)" class="video-player">
                Votre navigateur ne supporte pas l'élément vidéo.
              </video>
            </div>
            
            <!-- Изображение -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'image'" class="image-preview">
              <img [src]="getFileUrl(material.url)" [alt]="material.filename" class="material-image">
            </div>
            
            <!-- PDF -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'pdf'" class="pdf-preview">
              <a [href]="getFileUrl(material.url)" target="_blank" class="btn btn-sm btn-primary">
                <i class="fas fa-file-pdf"></i>
                Ouvrir le PDF
              </a>
            </div>
            
            <!-- Текст -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'text'" class="text-preview">
              <p class="text-content">{{ material.description || 'Contenu texte' }}</p>
            </div>
          </div>
          
          <!-- Домашние задания к материалу -->
          <div class="material-homework-section" *ngIf="getHomeworkForMaterial(material.id).length > 0">
            <div class="material-homework-header">
              <span class="material-homework-count">
                {{ getHomeworkForMaterial(material.id).length }} {{ getHomeworkForMaterial(material.id).length === 1 ? 'devoir' : 'devoirs' }}
              </span>
            </div>
            <div class="material-homework-list">
              <div *ngFor="let homework of getHomeworkForMaterial(material.id)" class="material-homework-item">
                <div class="material-homework-title">{{ homework.title }}</div>
                <div class="material-homework-description" *ngIf="homework.description">{{ homework.description }}</div>
                <div class="material-homework-due-date" *ngIf="homework.dueDate">
                  <i class="fas fa-calendar"></i>
                  {{ homework.dueDate | date:'dd/MM/yyyy' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="regularMaterials.length === 0" class="no-materials">
        <i class="fas fa-folder-open"></i>
        <p class="text-muted">Aucun matériau dans cette leçon</p>
      </div>
    </div>

    <!-- Дополнительные материалы -->
    <div class="lesson-supplementary-materials-section">
      <div class="section-header">
        <h3>
          <i class="fas fa-folder-plus"></i>
          Matériaux supplémentaires ({{ supplementaryMaterials.length }})
        </h3>
        <button 
          class="btn btn-sm btn-primary"
          (click)="openAddSupplementaryMaterial()"
          title="Ajouter un matériau supplémentaire">
          <i class="fas fa-plus"></i>
          Ajouter un matériau supplémentaire
        </button>
      </div>
      
      <div *ngIf="supplementaryMaterials.length > 0" class="materials-list">
        <div *ngFor="let material of supplementaryMaterials" class="material-item">
          <div class="material-header-row">
            <div class="material-icon">
              <i [class]="getMaterialTypeIcon(material.mimetype)"></i>
            </div>
            <div class="material-info">
              <h4>{{ material.filename }}</h4>
              <p *ngIf="material.description" class="material-desc">{{ material.description }}</p>
            </div>
            <div class="material-actions">
              <button 
                class="btn btn-xs btn-link"
                (click)="openAddHomework(material.id)"
                title="Ajouter un devoir à ce matériau">
                <i class="fas fa-plus"></i>
                Devoir
              </button>
            </div>
          </div>
          <div class="material-preview">
            <!-- Аудио -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'audio'" class="audio-preview">
              <audio controls [src]="getFileUrl(material.url)" class="audio-player">
                Votre navigateur ne supporte pas l'élément audio.
              </audio>
            </div>
            
            <!-- Видео -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'video'" class="video-preview">
              <video controls [src]="getFileUrl(material.url)" class="video-player">
                Votre navigateur ne supporte pas l'élément vidéo.
              </video>
            </div>
            
            <!-- Изображение -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'image'" class="image-preview">
              <img [src]="getFileUrl(material.url)" [alt]="material.filename" class="material-image">
            </div>
            
            <!-- PDF -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'pdf'" class="pdf-preview">
              <a [href]="getFileUrl(material.url)" target="_blank" class="btn btn-sm btn-primary">
                <i class="fas fa-file-pdf"></i>
                Ouvrir le PDF
              </a>
            </div>
            
            <!-- Текст -->
            <div *ngIf="getMaterialTypeFromMime(material.mimetype) === 'text'" class="text-preview">
              <p class="text-content">{{ material.description || 'Contenu texte' }}</p>
            </div>
            
            <!-- Drill-grid -->
            <div *ngIf="isDrillGrid(material)" class="drill-grid-preview">
              <div class="drill-grid-header">
                <h5>
                  <i class="fas fa-grid-on"></i>
                  {{ material.filename }}
                </h5>
                <p *ngIf="material.description" class="drill-grid-description">{{ material.description }}</p>
              </div>
              <div class="drill-grid-table-container" *ngIf="getDrillGridData(material)">
                <div class="drill-table">
                  <div class="drill-header-row">
                    <div class="drill-cell header-cell"></div>
                    <div class="drill-cell header-cell" *ngFor="let col of getDrillGridData(material).columns">
                      {{ col || 'Colonne' }}
                    </div>
                  </div>
                  <div class="drill-row" *ngFor="let row of getDrillGridData(material).rows; let rowIdx = index">
                    <div class="drill-cell header-cell">{{ row || 'Ligne' }}</div>
                    <div class="drill-cell" *ngFor="let col of getDrillGridData(material).columns; let colIdx = index">
                      {{ getDrillGridData(material).cells[rowIdx + '-' + colIdx] || '' }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Домашние задания к дополнительному материалу -->
          <div class="material-homework-section" *ngIf="getHomeworkForMaterial(material.id).length > 0">
            <div class="material-homework-header">
              <span class="material-homework-count">
                {{ getHomeworkForMaterial(material.id).length }} {{ getHomeworkForMaterial(material.id).length === 1 ? 'devoir' : 'devoirs' }}
              </span>
            </div>
            <div class="material-homework-list">
              <div *ngFor="let homework of getHomeworkForMaterial(material.id)" class="material-homework-item">
                <div class="material-homework-title">{{ homework.title }}</div>
                <div class="material-homework-description" *ngIf="homework.description">{{ homework.description }}</div>
                <div class="material-homework-due-date" *ngIf="homework.dueDate">
                  <i class="fas fa-calendar"></i>
                  {{ homework.dueDate | date:'dd/MM/yyyy' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="supplementaryMaterials.length === 0" class="no-materials">
        <i class="fas fa-folder-open"></i>
        <p class="text-muted">Aucun matériau supplémentaire dans cette leçon</p>
      </div>
    </div>

    <!-- Домашние задания (только общие задания урока, не задания к материалам) -->
    <div class="lesson-homework-section">
      <div class="section-header">
        <h3>
          <i class="fas fa-tasks"></i>
          Devoirs pour la leçon ({{ lessonHomeworkItems.length }})
        </h3>
        <button 
          class="btn btn-sm btn-primary"
          (click)="openAddHomework()"
          title="Ajouter un devoir pour la leçon">
          <i class="fas fa-plus"></i>
          Ajouter un devoir
        </button>
      </div>
      
      <div *ngIf="loadingHomework" class="loading-homework">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Chargement des devoirs...</span>
      </div>
      
      <div *ngIf="!loadingHomework && lessonHomeworkItems.length > 0" class="homework-list">
        <div *ngFor="let homework of lessonHomeworkItems" class="homework-item">
          <div class="homework-header">
            <h4>{{ homework.title || 'Devoir sans titre' }}</h4>
            <span *ngIf="homework.dueDate" class="homework-due-date">
              <i class="fas fa-calendar"></i>
              Échéance: {{ homework.dueDate | date:'dd/MM/yyyy' }}
            </span>
          </div>
          <div *ngIf="homework.description" class="homework-description">
            {{ homework.description }}
          </div>
          <div *ngIf="homework.type" class="homework-type">
            <span class="badge badge-info">{{ homework.type }}</span>
          </div>
        </div>
      </div>
      
      <div *ngIf="!loadingHomework && lessonHomeworkItems.length === 0" class="no-homework">
        <i class="fas fa-clipboard-list"></i>
        <p class="text-muted">Aucun devoir pour cette leçon</p>
      </div>
    </div>
  </div>
</div>

