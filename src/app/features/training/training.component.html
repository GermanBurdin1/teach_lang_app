<div class="training-container">
  <!-- Header -->
  <div class="training-header">
    <h1 class="page-title">
      <i class="fas fa-dumbbell"></i>
      Exercices d'Entraînement
    </h1>
    <p class="page-subtitle">Outils d'entraînement pour vos étudiants</p>
  </div>

  <!-- Training Sub-tabs -->
  <div class="training-tabs">
    <button 
      class="training-tab-btn"
      [class.active]="activeTrainingTab === 'audio'"
      (click)="setActiveTrainingTab('audio')">
      <i class="fas fa-headphones"></i>
      Écoute
    </button>
    <button 
      class="training-tab-btn"
      [class.active]="activeTrainingTab === 'reading'"
      (click)="setActiveTrainingTab('reading')">
      <i class="fas fa-book-open"></i>
      Lecture
    </button>
    <button 
      class="training-tab-btn"
      [class.active]="activeTrainingTab === 'writing'"
      (click)="setActiveTrainingTab('writing')">
      <i class="fas fa-pen"></i>
      Écriture
    </button>
    <button 
      class="training-tab-btn"
      [class.active]="activeTrainingTab === 'speaking'"
      (click)="setActiveTrainingTab('speaking')">
      <i class="fas fa-microphone"></i>
      Expression orale
    </button>
    <button 
      class="training-tab-btn"
      [class.active]="activeTrainingTab === 'grammar'"
      (click)="setActiveTrainingTab('grammar')">
      <i class="fas fa-language"></i>
      Grammaire
    </button>
  </div>

  <!-- Training Content -->
  <div class="training-content">
    <!-- Grammar Tab Content -->
    <div *ngIf="activeTrainingTab === 'grammar'" class="grammar-content">
      <!-- Part of Speech Content View -->
      <div *ngIf="selectedPartOfSpeech" class="part-of-speech-content">
        <button mat-button class="back-button" (click)="goBackToStructure()">
          <mat-icon>arrow_back</mat-icon>
          Retour à la structure
        </button>
        
        <h2 class="part-content-title">
          <mat-icon>{{ selectedPartOfSpeech.icon }}</mat-icon>
          {{ selectedPartOfSpeech.title }}
        </h2>

        <!-- Articles Content -->
        <div *ngIf="selectedPartOfSpeech.id === 'article'" class="pattern-cards-list">
          <div *ngIf="loadingPatternCards" class="loading-state">
            <p>Chargement des exercices...</p>
          </div>
          
          <div *ngIf="!loadingPatternCards && patternCards.length === 0" class="empty-state">
            <mat-icon>info</mat-icon>
            <p>Aucun exercice disponible pour le moment</p>
          </div>

          <div *ngIf="!loadingPatternCards && patternCards.length > 0" class="pattern-cards-grid">
            <div class="pattern-card-item" *ngFor="let card of patternCards">
              <div class="card-header">
                <h3>{{ card.constructorTitle || card.pattern }}</h3>
              </div>
              <div class="card-content">
                <p class="pattern-text"><strong>Pattern:</strong> {{ card.pattern }}</p>
                <p class="example-text"><strong>Exemple:</strong> {{ card.example }}</p>
                <div class="card-meta" *ngIf="card.difficulty">
                  <span class="difficulty-badge" [class]="'difficulty-' + card.difficulty">
                    {{ card.difficulty }}
                  </span>
                </div>
              </div>
              <div class="card-actions">
                <button mat-button color="primary" (click)="startExercise(card)">
                  <mat-icon>play_arrow</mat-icon>
                  Commencer
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Other Parts of Speech Content -->
        <div *ngIf="selectedPartOfSpeech.id !== 'article'" class="coming-soon-content">
          <mat-icon>construction</mat-icon>
          <h3>Fonctionnalité en développement</h3>
          <p>Les exercices pour {{ selectedPartOfSpeech.title }} seront bientôt disponibles</p>
        </div>
      </div>

      <!-- Grammar Structure View -->
      <div *ngIf="!selectedPartOfSpeech" class="grammar-structure">
        <div class="grammar-category" *ngFor="let category of grammarStructure">
          <div class="category-header" (click)="toggleCategory(category.id)">
            <mat-icon class="expand-icon" [class.expanded]="isExpanded(category.id)">
              {{ isExpanded(category.id) ? 'expand_more' : 'chevron_right' }}
            </mat-icon>
            <mat-icon class="category-icon">{{ category.icon }}</mat-icon>
            <span class="category-title">{{ category.title }}</span>
          </div>
          
          <!-- Level 2: Children of first level -->
          <div class="category-children" *ngIf="isExpanded(category.id) && category.children">
            <div class="grammar-category level-2" *ngFor="let child of category.children">
              <div class="category-header" (click)="toggleCategory(child.id)">
                <mat-icon class="expand-icon" [class.expanded]="isExpanded(child.id)">
                  {{ isExpanded(child.id) ? 'expand_more' : 'chevron_right' }}
                </mat-icon>
                <mat-icon class="category-icon">{{ child.icon }}</mat-icon>
                <span class="category-title">{{ child.title }}</span>
              </div>
              
              <!-- Level 3: Children of second level -->
              <div class="category-children" *ngIf="isExpanded(child.id) && child.children">
                <div class="grammar-category level-3" *ngFor="let subChild of child.children">
                  <div class="category-header" (click)="toggleCategory(subChild.id)">
                    <mat-icon class="expand-icon" [class.expanded]="isExpanded(subChild.id)">
                      {{ isExpanded(subChild.id) ? 'expand_more' : 'chevron_right' }}
                    </mat-icon>
                    <mat-icon class="category-icon">{{ subChild.icon }}</mat-icon>
                    <span class="category-title">{{ subChild.title }}</span>
                  </div>
                  
                  <!-- Level 4: Final level (parts of speech) -->
                  <div class="category-children" *ngIf="isExpanded(subChild.id) && subChild.children">
                    <div class="part-of-speech-item" *ngFor="let partOfSpeech of subChild.children" (click)="selectPartOfSpeech(partOfSpeech)">
                      <mat-icon class="part-icon">{{ partOfSpeech.icon }}</mat-icon>
                      <span class="part-title">{{ partOfSpeech.title }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Other tabs content -->
    <div *ngIf="activeTrainingTab !== 'grammar'" class="coming-soon">
      <i class="fas fa-tools"></i>
      <h3>Fonctionnalité en développement</h3>
      <p>Les exercices d'entraînement seront bientôt disponibles</p>
    </div>
  </div>
</div>

