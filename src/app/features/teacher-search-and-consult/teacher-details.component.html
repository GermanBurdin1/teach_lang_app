<div *ngIf="teacher" class="teacher-profile">
  <img [src]="teacher.photoUrl" alt="{{ teacher.name }}" class="avatar" />
  <h2>{{ teacher.name }}</h2>
  <p>‚òÖ {{ teacher.rating }} ‚Äî {{ teacher.specializations.join(', ') }}</p>
  <p><strong>Tarif :</strong> {{ teacher.price }} ‚Ç¨/heure</p>
  <p><strong>Exp√©rience :</strong> {{ teacher.experienceYears }} ans</p>
  <p><strong>Certificats :</strong> {{ teacher.certificates.join(', ') }}</p>
  <p class="bio">{{ teacher.bio }}</p>

  <!-- –ö—É—Ä—Å—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è -->
  <div class="teacher-courses-section mt-5">
    <h4>üìö Formations en ligne</h4>
    <div *ngIf="loadingCourses" class="loading-courses">
      <p>Chargement des formations...</p>
    </div>
    <div *ngIf="!loadingCourses && teacherCourses.length > 0" class="courses-list">
      <p class="courses-count">
        <strong>{{ teacherCourses.length }}</strong> formation{{ teacherCourses.length > 1 ? 's' : '' }} disponible{{ teacherCourses.length > 1 ? 's' : '' }}
      </p>
      
      <!-- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã -->
      <div *ngIf="freeCourses.length > 0" class="courses-group free-courses-group">
        <h5 class="courses-group-title">
          <mat-icon class="group-icon free-icon">free_breakfast</mat-icon>
          Cours gratuits ({{ freeCourses.length }})
        </h5>
        <div class="courses-grid">
          <div *ngFor="let course of displayedFreeCourses" class="course-card free-course-card" (click)="viewCourseDetails(course.id)">
            <div class="course-card-header">
              <h5>{{ course.title }}</h5>
              <span class="course-status-badge published">
                <mat-icon>public</mat-icon>
                Publi√©
              </span>
            </div>
            <div class="course-card-content">
              <p *ngIf="course.level" class="course-level">
                üìä Niveau: {{ course.level }}
              </p>
              <p *ngIf="course.description" class="course-description">
                {{ course.description }}
              </p>
              <div *ngIf="course.sections && course.sections.length > 0" class="course-sections-preview">
                <small>{{ course.sections.length }} section{{ course.sections.length > 1 ? 's' : '' }}</small>
              </div>
              <div class="course-price-badge free">
                <mat-icon>free_breakfast</mat-icon>
                <span>Gratuit</span>
              </div>
            </div>
            <div class="course-card-footer">
              <button class="btn btn-sm btn-primary">Voir les d√©tails</button>
            </div>
          </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ "Voir plus" –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ -->
        <div *ngIf="hasMoreFreeCourses" class="load-more-container" style="text-align: center; margin-top: 20px;">
          <button mat-raised-button color="primary" (click)="loadMoreFreeCourses()" class="load-more-button">
            <mat-icon>expand_more</mat-icon>
            Voir plus ({{ freeCourses.length - displayedFreeCoursesCount }} restant{{ freeCourses.length - displayedFreeCoursesCount > 1 ? 's' : '' }})
          </button>
        </div>
      </div>

      <!-- –ü–ª–∞—Ç–Ω—ã–µ –∫—É—Ä—Å—ã -->
      <div *ngIf="paidCourses.length > 0" class="courses-group paid-courses-group">
        <h5 class="courses-group-title">
          <mat-icon class="group-icon paid-icon">euro</mat-icon>
          Cours payants ({{ paidCourses.length }})
        </h5>
        <div class="courses-grid">
          <div *ngFor="let course of displayedPaidCourses" class="course-card paid-course-card" (click)="viewCourseDetails(course.id)">
            <div class="course-card-header">
              <h5>{{ course.title }}</h5>
              <span class="course-status-badge published">
                <mat-icon>public</mat-icon>
                Publi√©
              </span>
            </div>
            <div class="course-card-content">
              <p *ngIf="course.level" class="course-level">
                üìä Niveau: {{ course.level }}
              </p>
              <p *ngIf="course.description" class="course-description">
                {{ course.description }}
              </p>
              <div *ngIf="course.sections && course.sections.length > 0" class="course-sections-preview">
                <small>{{ course.sections.length }} section{{ course.sections.length > 1 ? 's' : '' }}</small>
              </div>
              <div class="course-price-badge paid">
                <mat-icon>euro</mat-icon>
                <span>{{ getCoursePrice(course) }}</span>
              </div>
            </div>
            <div class="course-card-footer">
              <button class="btn btn-sm btn-primary">Voir les d√©tails</button>
            </div>
          </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∞ "Voir plus" –¥–ª—è –ø–ª–∞—Ç–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ -->
        <div *ngIf="hasMorePaidCourses" class="load-more-container" style="text-align: center; margin-top: 20px;">
          <button mat-raised-button color="primary" (click)="loadMorePaidCourses()" class="load-more-button">
            <mat-icon>expand_more</mat-icon>
            Voir plus ({{ paidCourses.length - displayedPaidCoursesCount }} restant{{ paidCourses.length - displayedPaidCoursesCount > 1 ? 's' : '' }})
          </button>
        </div>
      </div>
    </div>
    <div *ngIf="!loadingCourses && teacherCourses.length === 0" class="no-courses">
      <p class="text-muted">Ce professeur n'a pas encore publi√© de formations en ligne.</p>
    </div>
  </div>

  <h4 class="mt-5">Avis des √©tudiants</h4>
  <app-review-list [reviews]="reviews"></app-review-list>

  <div class="actions">
    <button class="btn btn-outline-primary" (click)="openMessageModal()">Envoyer un message</button>
    <button class="btn btn-success ms-2" (click)="openBookingModal()">R√©server un cours</button>
  </div>
</div>

<div *ngIf="!teacher" class="not-found">
  Enseignant introuvable.
</div>

<ng-container *ngIf="showMessageModal">
  <div class="modal-overlay d-flex align-items-center justify-content-center">
    <div class="bg-white p-4 rounded shadow modal-content-custom">
      <h5 class="mb-3">Message √† l‚Äôenseignant</h5>
      <textarea [(ngModel)]="messageText" class="form-control mb-3" rows="4"
        placeholder="√âcrivez votre message..."></textarea>
      <div class="d-flex justify-content-end gap-2">
        <button class="btn btn-secondary" (click)="closeMessageModal()">Annuler</button>
        <button class="btn btn-primary" (click)="sendMessage(messageText)">Envoyer</button>
      </div>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="showBookingModal">
  <div class="modal-overlay d-flex align-items-center justify-content-center">
    <div class="bg-white p-4 rounded shadow modal-content-custom">
      <h5 class="mb-3">R√©server un cours</h5>

      <div class="mb-3">
        <label for="date" class="form-label">Date</label>
        <input type="text" bsDatepicker [(ngModel)]="selectedDate" (ngModelChange)="onDateChange()" class="form-control">
      </div>

      <div class="mb-3">
        <label class="form-label">Cr√©neaux disponibles</label>
        <div *ngIf="teacherSchedule.length === 0" class="text-muted">
          Chargement des cr√©neaux...
        </div>
        
        <!-- Simple grid pour √©tudiants - juste disponible/indisponible -->
        <div class="simple-time-grid">
          <button 
            *ngFor="let slot of teacherSchedule" 
            type="button"
            class="simple-time-btn"
            [class.available]="slot.available"
            [class.unavailable]="!slot.available"
            [class.selected]="selectedTime === slot.time"
            [disabled]="!slot.available"
            (click)="selectTimeSlot(slot.time)">
            {{ slot.time }}
          </button>
        </div>
        
        <div *ngIf="hasNoAvailableSlots()" class="text-warning mt-2">
          ‚ö†Ô∏è Aucun cr√©neau disponible pour cette date
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2">
        <button class="btn btn-secondary" (click)="closeBookingModal()">Annuler</button>
        <button class="btn btn-success" (click)="confirmBooking()">Confirmer et payer</button>
      </div>
    </div>
  </div>
</ng-container>

<!-- DEBUG: showPaymentModal = {{ showPaymentModal }} -->
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã -->
<app-payment-modal
  *ngIf="showPaymentModal"
  [teacher]="teacher"
  [selectedDate]="selectedDate"
  [selectedTime]="selectedTime"
  [lessonDuration]="lessonDuration"
  (paymentSuccess)="onPaymentSuccess($event)"
  (paymentCancel)="onPaymentCancel()">
</app-payment-modal>
