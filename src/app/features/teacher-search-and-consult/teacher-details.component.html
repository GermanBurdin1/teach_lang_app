<div *ngIf="teacher" class="teacher-profile">
  <img [src]="teacher.photoUrl" alt="{{ teacher.name }}" class="avatar" />
  <h2>{{ teacher.name }}</h2>
  <p>â˜… {{ teacher.rating }} â€” {{ teacher.specializations.join(', ') }}</p>
  <p><strong>Tarif :</strong> {{ teacher.price }} â‚¬/heure</p>
  <p><strong>ExpÃ©rience :</strong> {{ teacher.experienceYears }} ans</p>
  <p><strong>Certificats :</strong> {{ teacher.certificates.join(', ') }}</p>
  <p class="bio">{{ teacher.bio }}</p>

  <!-- ĞšÑƒÑ€ÑÑ‹ Ğ¿Ñ€ĞµĞ¿Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ĞµĞ»Ñ -->
  <div class="teacher-courses-section mt-5">
    <h4>ğŸ“š Formations en ligne</h4>
    <div *ngIf="loadingCourses" class="loading-courses">
      <p>Chargement des formations...</p>
    </div>
    <div *ngIf="!loadingCourses && teacherCourses.length > 0" class="courses-list">
      <p class="courses-count">
        <strong>{{ teacherCourses.length }}</strong> formation{{ teacherCourses.length > 1 ? 's' : '' }} disponible{{ teacherCourses.length > 1 ? 's' : '' }}
      </p>
      
      <!-- Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğµ ĞºÑƒÑ€ÑÑ‹ -->
      <div *ngIf="freeCourses.length > 0" class="courses-group free-courses-group">
        <h5 class="courses-group-title">
          <mat-icon class="group-icon free-icon">free_breakfast</mat-icon>
          Cours gratuits ({{ freeCourses.length }})
        </h5>
        <div class="courses-grid">
          <div *ngFor="let course of freeCourses" class="course-card free-course-card" (click)="viewCourseDetails(course.id)">
            <div class="course-card-header">
              <h5>{{ course.title }}</h5>
              <span class="course-status-badge published">
                <mat-icon>public</mat-icon>
                PubliÃ©
              </span>
            </div>
            <div class="course-card-content">
              <p *ngIf="course.level" class="course-level">
                ğŸ“Š Niveau: {{ course.level }}
              </p>
              <p *ngIf="course.description" class="course-description">
                {{ course.description }}
              </p>
              <div *ngIf="course.sections && course.sections.length > 0" class="course-sections-preview">
                <small>{{ course.sections.length }} section{{ course.sections.length > 1 ? 's' : '' }}</small>
              </div>
              <div class="course-price-badge free">
                <mat-icon>free_breakfast</mat-icon>
                <span>Gratuit</span>
              </div>
            </div>
            <div class="course-card-footer">
              <button class="btn btn-sm btn-primary">Voir les dÃ©tails</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ĞŸĞ»Ğ°Ñ‚Ğ½Ñ‹Ğµ ĞºÑƒÑ€ÑÑ‹ -->
      <div *ngIf="paidCourses.length > 0" class="courses-group paid-courses-group">
        <h5 class="courses-group-title">
          <mat-icon class="group-icon paid-icon">euro</mat-icon>
          Cours payants ({{ paidCourses.length }})
        </h5>
        <div class="courses-grid">
          <div *ngFor="let course of paidCourses" class="course-card paid-course-card" (click)="viewCourseDetails(course.id)">
            <div class="course-card-header">
              <h5>{{ course.title }}</h5>
              <span class="course-status-badge published">
                <mat-icon>public</mat-icon>
                PubliÃ©
              </span>
            </div>
            <div class="course-card-content">
              <p *ngIf="course.level" class="course-level">
                ğŸ“Š Niveau: {{ course.level }}
              </p>
              <p *ngIf="course.description" class="course-description">
                {{ course.description }}
              </p>
              <div *ngIf="course.sections && course.sections.length > 0" class="course-sections-preview">
                <small>{{ course.sections.length }} section{{ course.sections.length > 1 ? 's' : '' }}</small>
              </div>
              <div class="course-price-badge paid">
                <mat-icon>euro</mat-icon>
                <span>{{ getCoursePrice(course) }}</span>
              </div>
            </div>
            <div class="course-card-footer">
              <button class="btn btn-sm btn-primary">Voir les dÃ©tails</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="!loadingCourses && teacherCourses.length === 0" class="no-courses">
      <p class="text-muted">Ce professeur n'a pas encore publiÃ© de formations en ligne.</p>
    </div>
  </div>

  <h4 class="mt-5">Avis des Ã©tudiants</h4>
  <app-review-list [reviews]="reviews"></app-review-list>

  <div class="actions">
    <button class="btn btn-outline-primary" (click)="openMessageModal()">Envoyer un message</button>
    <button class="btn btn-success ms-2" (click)="openBookingModal()">RÃ©server un cours</button>
  </div>
</div>

<div *ngIf="!teacher" class="not-found">
  Enseignant introuvable.
</div>

<ng-container *ngIf="showMessageModal">
  <div class="modal-overlay d-flex align-items-center justify-content-center">
    <div class="bg-white p-4 rounded shadow modal-content-custom">
      <h5 class="mb-3">Message Ã  lâ€™enseignant</h5>
      <textarea [(ngModel)]="messageText" class="form-control mb-3" rows="4"
        placeholder="Ã‰crivez votre message..."></textarea>
      <div class="d-flex justify-content-end gap-2">
        <button class="btn btn-secondary" (click)="closeMessageModal()">Annuler</button>
        <button class="btn btn-primary" (click)="sendMessage(messageText)">Envoyer</button>
      </div>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="showBookingModal">
  <div class="modal-overlay d-flex align-items-center justify-content-center">
    <div class="bg-white p-4 rounded shadow modal-content-custom">
      <h5 class="mb-3">RÃ©server un cours</h5>

      <div class="mb-3">
        <label for="date" class="form-label">Date</label>
        <input type="text" bsDatepicker [(ngModel)]="selectedDate" (ngModelChange)="onDateChange()" class="form-control">
      </div>

      <div class="mb-3">
        <label class="form-label">CrÃ©neaux disponibles</label>
        <div *ngIf="teacherSchedule.length === 0" class="text-muted">
          Chargement des crÃ©neaux...
        </div>
        
        <!-- Simple grid pour Ã©tudiants - juste disponible/indisponible -->
        <div class="simple-time-grid">
          <button 
            *ngFor="let slot of teacherSchedule" 
            type="button"
            class="simple-time-btn"
            [class.available]="slot.available"
            [class.unavailable]="!slot.available"
            [class.selected]="selectedTime === slot.time"
            [disabled]="!slot.available"
            (click)="selectTimeSlot(slot.time)">
            {{ slot.time }}
          </button>
        </div>
        
        <div *ngIf="hasNoAvailableSlots()" class="text-warning mt-2">
          âš ï¸ Aucun crÃ©neau disponible pour cette date
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2">
        <button class="btn btn-secondary" (click)="closeBookingModal()">Annuler</button>
        <button class="btn btn-success" (click)="confirmBooking()">Confirmer et payer</button>
      </div>
    </div>
  </div>
</ng-container>

<!-- DEBUG: showPaymentModal = {{ showPaymentModal }} -->
<!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ -->
<app-payment-modal
  *ngIf="showPaymentModal"
  [teacher]="teacher"
  [selectedDate]="selectedDate"
  [selectedTime]="selectedTime"
  [lessonDuration]="lessonDuration"
  (paymentSuccess)="onPaymentSuccess($event)"
  (paymentCancel)="onPaymentCancel()">
</app-payment-modal>
