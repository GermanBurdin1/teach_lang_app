<div class="teacher-home">

  <!-- üîº –í–ï–†–•–ù–Ø–Ø –ß–ê–°–¢–¨ -->
  <div class="top-section">

    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <div class="column left-column">
      <h3>üîî Notifications</h3>
      
      <div *ngIf="notifications.length > 0; else noNotifications" class="notifications-container">
        <div *ngFor="let note of visibleNotifications" class="notification-card">
          <div class="notification-content">
            <div class="notification-text">
              <strong>{{ note.title }}</strong><br />
              <small>{{ note.message }}</small>
            </div>
            
            <div class="notification-actions">
              <!-- Hide button -->
              <button mat-icon-button 
                      class="hide-button" 
                      (click)="hideNotification(note)"
                      matTooltip="Masquer cette notification">
                <mat-icon>close</mat-icon>
              </button>
            </div>
          </div>
        </div>
        
        <!-- Show more/less button -->
        <div *ngIf="hasMoreNotifications" class="show-more-container">
          <button mat-stroked-button 
                  color="accent" 
                  (click)="toggleShowMore()">
            {{ showMoreNotifications ? 'Voir moins' : 'Voir plus (' + (notifications.length - MAX_NOTIFICATIONS) + ')' }}
            <mat-icon>{{ showMoreNotifications ? 'expand_less' : 'expand_more' }}</mat-icon>
          </button>
        </div>
      </div>
      
      <ng-template #noNotifications>
        <div class="no-notifications">
          <mat-icon class="no-notifications-icon">notifications_off</mat-icon>
          <p>‚úÖ Aucun nouveau message</p>
        </div>
      </ng-template>

      <h3>üì® Nouvelles demandes <span *ngIf="newRequests.length">+{{ newRequests.length }}</span></h3>

      <!-- –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∑–∞—è–≤–∫–∏ -->
      <ng-container *ngIf="treatedRequests.length > 0">
        <h4 class="mt-4">‚úÖ Demandes trait√©es</h4>
        <mat-card *ngFor="let req of treatedRequests" class="request-card treated">
          <mat-card-title>{{ req.title }}</mat-card-title>
          <mat-card-content>
            <p>{{ req.message }}</p>
            <span>Status: <strong>{{ req.status }}</strong></span>
          </mat-card-content>
        </mat-card>
      </ng-container>


      <mat-card *ngFor="let req of newRequests.slice(0, shownRequests)" class="request-card">
        <mat-card-title>{{ req.title }}</mat-card-title>
        <mat-card-content>
          <p>{{ req.message }}</p>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-raised-button color="primary" (click)="respondToRequest(req, true)">
            Accepter
          </button>
          <button mat-stroked-button color="warn" (click)="respondToRequest(req, false)">
            Refuser
          </button>
        </mat-card-actions>
      </mat-card>

      <mat-card *ngIf="showRefuseDialog" class="request-card">
        <mat-card-title>Refuser ou proposer un autre horaire</mat-card-title>
        <mat-card-content>
          <mat-radio-group [(ngModel)]="selectedRefusalMode">
            <mat-radio-button value="refuse">Refuser la demande</mat-radio-button>
            <mat-radio-button value="propose">Proposer un autre horaire</mat-radio-button>
          </mat-radio-group>

          <div *ngIf="selectedRefusalMode === 'refuse'" class="mt-2">
            <mat-radio-group [(ngModel)]="selectedReason">
              <mat-radio-button *ngFor="let reason of REJECTION_REASONS" [value]="reason">{{ reason }}</mat-radio-button>
            </mat-radio-group>
            <mat-form-field *ngIf="selectedReason === 'Autre'" appearance="fill" class="w-full">
              <mat-label>Pr√©cisez</mat-label>
              <input matInput [(ngModel)]="customReason" />
            </mat-form-field>
          </div>

          <div *ngIf="selectedRefusalMode === 'propose'" class="mt-2">
            <mat-form-field appearance="fill">
              <mat-label>Date</mat-label>
              <input matInput [matDatepicker]="altDatePicker" [(ngModel)]="selectedAlternativeDate">
              <mat-datepicker-toggle matSuffix [for]="altDatePicker"></mat-datepicker-toggle>
              <mat-datepicker #altDatePicker></mat-datepicker>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Heure</mat-label>
              <input matInput type="time" [(ngModel)]="selectedAlternativeTime">
            </mat-form-field>
          </div>
        </mat-card-content>
        <mat-card-actions align="end">
          <button mat-button (click)="showRefuseDialog = false">Annuler</button>
          <button mat-raised-button color="warn" (click)="confirmRefusal()">Envoyer</button>
        </mat-card-actions>
      </mat-card>

      <div class="voir-plus-wrapper" *ngIf="newRequests.length > 5">
        <button mat-button color="accent" *ngIf="shownRequests < newRequests.length" (click)="loadMore()">
          Voir plus
        </button>
        <button mat-button color="warn" *ngIf="shownRequests > 5" (click)="reduce()">
          R√©duire
        </button>


      </div>

      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
      <div class="column right-column">
        <h3>üìã Devoirs √† corriger</h3>
        <ul>
          <li *ngFor="let hw of homeworksToReview">
            {{ hw.title }} ‚Äî {{ hw.student }} (pour le {{ hw.dueDate }})
          </li>
        </ul>
      </div>

    </div>

    <!-- üîΩ –ù–ò–ñ–ù–Ø–Ø –ß–ê–°–¢–¨ -->
    <div class="bottom-section">
      <h3>üóìÔ∏è Prochains cours</h3>
      <div class="calendar-wrapper">
        <app-calendar-preview [events]="upcomingLessons"></app-calendar-preview>
      </div>
    </div>

  </div>
