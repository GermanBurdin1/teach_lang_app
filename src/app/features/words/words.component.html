<div class="container" [ngClass]="{
  'zoom-active': zoomedGalaxy,
  'zoom-to-galaxy': isZoomingToGalaxy
}">
  <div class="search-bar-container">
    <div class="search-bar">
      <input [(ngModel)]="searchQuery" placeholder="Rechercher un mot ou une expression..." (input)="searchWord()" />
    </div>
    <button class="add-word-btn" (click)="openGlobalAddWordOrExpressionModal()" title="Ajouter un mot ou expression">
      <i class="fas fa-plus"></i>
    </button>
  </div>

  <div *ngIf="searchResults.length" class="search-results">
    <div *ngFor="let result of searchResults" class="search-result-item" (click)="navigateToWord(result)"
      title="–ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–æ–≤—É">
      <strong>{{ result.word }}</strong> ‚Äî {{ result.translation }}
      <div style="font-size: 12px; color: gray;">
        {{ result.fullPath }}
      </div>
    </div>
  </div>


  <h2 *ngIf="!zoomedGalaxy">
  </h2>


  <div class="galaxies" *ngIf="!zoomedGalaxy">
    <div *ngFor="let galaxy of galaxies; let i = index" class="galaxy-wrapper" #galaxyWrapper>
      <div class="galaxy" (click)="zoomIntoGalaxy(galaxy)">
        <svg #galaxyElement viewBox="0 0 200 200" class="galaxy-svg">
          <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç -->
          <defs>
            <radialGradient [attr.id]="'galaxyGradient-' + galaxy.sanitizedName" cx="50%" cy="50%" r="50%">
              <stop offset="0%" style="stop-color:#7d5ba6; stop-opacity:1" />
              <stop offset="100%" style="stop-color:#2c2a4a; stop-opacity:1" />
            </radialGradient>

            <radialGradient id="planetGradient" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stop-color="#ffd27f" />
              <stop offset="60%" stop-color="#ff914d" />
              <stop offset="100%" stop-color="#cc4b2c" />
            </radialGradient>
          </defs>

          <!-- –ü—Ä–∏–º–µ–Ω—è–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç -->
          <ellipse cx="100" cy="100" rx="90" ry="60"
            [attr.fill]="'url(#galaxyGradient-' + galaxy.sanitizedName + ')'" />

          <!-- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã –≤ —Ü–µ–Ω—Ç—Ä–µ -->
          <text x="100" y="105" fill="white" font-size="20px" font-weight="bold" font-family="Arial"
            text-anchor="middle">
            {{ galaxy.name }}
          </text>


          <!-- –ü–ª—é—Å–∏–∫ –ø—Ä—è–º–æ –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º -->
          <foreignObject x="90" y="115" width="20" height="20">
            <button class="galaxy-add-button" (click)="onGalaxyAddButtonClick($event, galaxy.name)"
              title="Ajouter un mot ou une expression">
              +
            </button>
          </foreignObject>


          <!-- –ü–æ–¥—Ç–µ–º—ã (–ø–ª–∞–Ω–µ—Ç—ã) -->
          <g *ngFor="let subtopic of galaxy.subtopics">
            <title>
              {{ subtopic.name }} ({{ getWordAndExpressionCount(galaxy.name, subtopic.name) }})
            </title>
            <circle [attr.cx]="subtopic.x" [attr.cy]="subtopic.y" r="8" fill="url(#planetGradient)">
            </circle>
          </g>
        </svg>

      </div>
    </div>
  </div>

  <!-- –ó—É–º–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–∞–ª–∞–∫—Ç–∏–∫–∞ -->
  <div class="zoomed-galaxy" *ngIf="zoomedGalaxy && !isZoomingToGalaxy">
    <button class="back-btn" (click)="resetZoom()">Retourner √† la page principale</button>
    <div class="zoom-container" [ngStyle]="isZoomingToPlanet ? zoomStyle : {}">
      <svg viewBox="0 0 600 600" class="galaxy-svg zoom">
        <!-- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –∑—É–º–∞ -->
        <defs>
          <radialGradient id="galaxyGradient-zoom" cx="50%" cy="50%" r="50%">
            <stop offset="0%" style="stop-color:#7d5ba6; stop-opacity:1" />
            <stop offset="100%" style="stop-color:#2c2a4a; stop-opacity:1" />
          </radialGradient>

          <radialGradient id="planetGradient" cx="50%" cy="50%" r="50%">
            <stop offset="0%" stop-color="#ffd27f" />
            <stop offset="60%" stop-color="#ff914d" />
            <stop offset="100%" stop-color="#cc4b2c" />
          </radialGradient>
        </defs>

        <ellipse cx="300" cy="300" rx="270" ry="180" fill="url(#galaxyGradient-zoom)" />

        <!-- –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã –≤ —Ü–µ–Ω—Ç—Ä–µ -->
        <text x="300" y="310" fill="white" font-size="42px" font-weight="bold" font-family="Arial" text-anchor="middle">
          {{ zoomedGalaxy.name }}
        </text>

        <!-- –ü–æ–¥—Ç–µ–º—ã (–ø–ª–∞–Ω–µ—Ç—ã) -->
        <g *ngFor="let subtopic of zoomedGalaxy.subtopics">
          <title>
            ({{ getWordAndExpressionCount(subtopic.name, zoomedGalaxy.name) }})
          </title>
          <circle class="subtopic-planet" #subtopicElement [attr.cx]="subtopic.x * 3" [attr.cy]="subtopic.y * 3" r="60"
            (mouseenter)="hoverSubtopic(subtopic)" (click)="onSubtopicClick(zoomedGalaxy.name, subtopic.name)">
          </circle>

          <foreignObject [attr.x]="subtopic.x * 3 - 50" [attr.y]="subtopic.y * 3 - 20" width="100" height="40">
            <div #labelRef class="subtopic-label-wrapper">
              {{ subtopic.name }}
            </div>
          </foreignObject>
        </g>


      </svg>
    </div>
  </div>
</div>


<!-- –º–æ–¥–∞–ª–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–≤–∞ –∏–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –º–µ—Å—Ç–µ-->
<div class="modal-overlay" *ngIf="showGlobalAddWordOrExpressionModal">
  <div class="add-entry-modal">
    <button class="add-entry-modal__close-btn" (click)="closeGlobalAddWordOrExpressionModal()" aria-label="–ó–∞–∫—Ä—ã—Ç—å">
      <i class="fas fa-times"></i>
    </button>

    <h2 class="add-entry-modal__title">Ajouter un mot ou expression</h2>

    <div class="add-entry-modal__type-toggle">
      <!-- –¢–∏–ø –∫–∞—Ä—Ç–æ—á–∫–∏: —Å–ª–æ–≤–æ/–≤—ã—Ä–∞–∂–µ–Ω–∏–µ -->
      <button (click)="toggleGlobalType()" class="add-entry-modal__toggle-type"
        [attr.aria-label]="'–¢–∏–ø: ' + (newGlobalType === 'word' ? '–°–ª–æ–≤–æ' : '–í—ã—Ä–∞–∂–µ–Ω–∏–µ')">
        {{ newGlobalType === 'word' ? '‚û§ –°–ª–æ–≤–æ' : '‚û§ –í—ã—Ä–∞–∂–µ–Ω–∏–µ' }}
      </button>

    </div>
    <div class="lang-selectors">
      <label>–° —è–∑—ã–∫–∞:
        <select [(ngModel)]="sourceLang">
          <option value="ru">—Ä—É—Å—Å–∫–∏–π</option>
          <option value="fr">—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
          <option value="en">–∞–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
        </select>
      </label>

      <label>–ù–∞ —è–∑—ã–∫:
        <select [(ngModel)]="targetLang">
          <option value="ru">—Ä—É—Å—Å–∫–∏–π</option>
          <option value="fr">—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
          <option value="en">–∞–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
        </select>
      </label>
    </div>
    <input [(ngModel)]="newGlobalWord" [placeholder]="newGlobalType === 'word' ? '–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ' : '–í–≤–µ–¥–∏—Ç–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ'"
      class="add-entry-modal__input" />
    <input [(ngModel)]="newGlobalTranslation" (input)="onGlobalTranslationInput()" placeholder="–ü–µ—Ä–µ–≤–æ–¥ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
      class="add-entry-modal__input" />
    <app-grammar-fields *ngIf="grammarData && newGlobalType === 'word'" [grammar]="grammarData"
      (grammarChange)="onGrammarChange($event)">
    </app-grammar-fields>

    <button (click)="autoTranslateWord()" class="generate-button">
      üåê –ù–∞–π—Ç–∏ –ø–µ—Ä–µ–≤–æ–¥
    </button>


    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
    <select *ngIf="!isFromGalaxyShortcut" [(ngModel)]="selectedGalaxy" (change)="onGalaxySelected()"
      class="add-entry-modal__select">
      <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
      <option *ngFor="let galaxy of galaxies" [value]="galaxy.name">{{ galaxy.name }}</option>
    </select>

    <!-- –ü–æ–¥—Ç–µ–º–∞ -->
    <select *ngIf="availableSubtopics.length && !isFromGalaxyShortcut" [(ngModel)]="selectedSubtopic"
      class="add-entry-modal__select">
      <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥—Ç–µ–º—É</option>
      <option *ngFor="let subtopic of availableSubtopics" [value]="subtopic">{{ subtopic }}</option>
    </select>

    <button *ngIf="!isFromGalaxyShortcut" class="generate-button" (click)="generateWithGPT()">
      ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
    </button>

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ -->
    <div *ngIf="addSuccessMessage" class="add-entry-modal__message">
      {{ addSuccessMessage }}
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="add-entry-modal__actions">
      <button (click)="saveGlobalWordOrExpression()" class="add-entry-modal__button"
        [disabled]="!newGlobalWord.trim() || !selectedGalaxy || !selectedSubtopic">
        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
      </button>
      <button class="add-entry-modal__button add-entry-modal__cancel" (click)="closeGlobalAddWordOrExpressionModal()">
        –û—Ç–º–µ–Ω–∞
      </button>
    </div>

  </div>
</div>
