<div class="video-call-container" [class.floating]="isFloatingMode" [class.screen-sharing-active]="isScreenSharing"
  (mousedown)="startVideoDrag($event)">
  
           <!-- –û–°–ù–û–í–ù–û–ï –í–ò–î–ï–û -->
         <div class="main-video-container" 
              [style.width.px]="videoWidth" 
              [style.height.px]="videoHeight"
              (mouseenter)="showVideoControls()" 
              (mouseleave)="hideVideoControls()">
           
           <!-- –†–ï–ñ–ò–ú –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Ø: –í–∏–¥–∏—Ç –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ + —Å–µ–±—è –≤ —Å–µ—Ç–∫–µ -->
           <ng-container *ngIf="isTeacher()">
             <div class="teacher-grid-view">
               <div class="video-grid" [class]="'grid-' + getTeacherGridLayout()">
                 <!-- –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ —É—á–∏—Ç–µ–ª—è (–≤—Å–µ–≥–¥–∞ –ø–µ—Ä–≤—ã–º) -->
                 <div class="grid-video-item teacher-self">
                   <video #localVideo autoplay playsinline muted class="grid-video-stream"></video>
                   <div class="video-label">{{ getParticipantDisplayName(videoCallService.userId) }} (–í—ã)</div>
                 </div>
                 
                 <!-- –£–¥–∞–ª–µ–Ω–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã -->
                 <div *ngFor="let uid of remoteUserIds" class="grid-video-item">
                   <video id="remote-video-{{ uid }}" autoplay playsinline class="grid-video-stream"></video>
                   <div class="video-label">{{ getParticipantDisplayName(uid) }}</div>
                 </div>
               </div>
               
               <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
               <div *ngIf="remoteUserIds.length === 0" class="waiting-overlay">
                 <div class="waiting-message">üè´ –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...</div>
               </div>
             </div>
           </ng-container>

           <!-- –†–ï–ñ–ò–ú –°–¢–£–î–ï–ù–¢–ê: –í–∏–¥–∏—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –∫—Ä—É–ø–Ω–æ -->
           <ng-container *ngIf="!isTeacher()">
             <div *ngIf="remoteUserIds.length > 0; else studentWaiting" class="student-teacher-view">
               <!-- –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å, –∏–Ω–∞—á–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ -->
               <ng-container *ngIf="getTeacherUID(); else showFirstParticipant">
                 <video [id]="'remote-video-' + getTeacherUID()"
                        autoplay 
                        playsinline 
                        class="main-video-stream">
                 </video>
                 <div class="teacher-info">{{ getTeacherName() }}</div>
               </ng-container>
               
               <ng-template #showFirstParticipant>
                 <video *ngIf="remoteUserIds[0]"
                        [id]="'remote-video-' + remoteUserIds[0]"
                        autoplay 
                        playsinline 
                        class="main-video-stream">
                 </video>
                 <div class="teacher-info">{{ getParticipantDisplayName(remoteUserIds[0]) }}</div>
               </ng-template>
             </div>
             <ng-template #studentWaiting>
               <div class="waiting-state">
                 <video #localVideo autoplay playsinline class="main-video-stream"></video>
                 <div class="waiting-message">üìö –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —É—Ä–æ–∫—É...</div>
               </div>
             </ng-template>
           </ng-container>

    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="controls-overlay">
      <button class="control-btn" (click)="toggleCall()"
        title="{{ callActive ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫' : '–í–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –∑–≤–æ–Ω–æ–∫' }}">
      <i [class]="callActive ? 'fas fa-phone-slash' : 'fas fa-phone'"></i>
    </button>

      <button class="control-btn share-screen-btn" (click)="toggleScreenSharing()"
        title="{{ isScreenSharing ? '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é' : '–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —ç–∫—Ä–∞–Ω–∞' }}">
      <i [class]="isScreenSharing ? 'fas fa-stop-circle' : 'fas fa-desktop'"></i>
    </button>
    </div>

    <!-- –û–±–ª–∞—Å—Ç—å –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ -->
    <div class="resize-handle" (mousedown)="startResize($event)"></div>
  </div>

         <!-- PICTURE-IN-PICTURE –í–ò–î–ï–û -->
         <div class="pip-container">
           <!-- –î–õ–Ø –°–¢–£–î–ï–ù–¢–û–í: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–±—è –≤ PiP -->
           <ng-container *ngIf="!isTeacher()">
             <!-- –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤—Å–µ–≥–¥–∞ –≤ PiP -->
             <div class="local-video-pip">
               <video #localVideoPip autoplay playsinline muted class="pip-video-stream"></video>
               <div class="pip-label">{{ getParticipantDisplayName(videoCallService.userId) }} (–í—ã)</div>
             </div>

             <!-- –î—Ä—É–≥–∏–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –≤ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Å–µ—Ç–∫–µ -->
             <div *ngIf="getOtherStudents().length > 0" class="students-pip-grid">
               <div *ngFor="let studentId of getOtherStudents(); trackBy: trackByStudentId" class="student-pip">
                 <video [id]="'student-pip-' + studentId" autoplay playsinline class="pip-video-stream"></video>
                 <div class="pip-label">{{ getParticipantDisplayName(studentId) }}</div>
               </div>
             </div>
           </ng-container>

           <!-- –î–õ–Ø –ü–†–ï–ü–û–î–ê–í–ê–¢–ï–õ–Ø: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –≤ PiP -->
           <ng-container *ngIf="isTeacher() && remoteUserIds.length > 0">
             <div class="teacher-student-pip draggable-pip" 
                  [style.left.px]="pipPosition.x" 
                  [style.top.px]="pipPosition.y"
                  (mousedown)="startDrag($event)">
               <video [id]="'remote-video-' + remoteUserIds[0]" autoplay playsinline class="pip-video-stream"></video>
               <div class="pip-label">{{ getParticipantDisplayName(remoteUserIds[0]) }}</div>
               <div class="drag-handle">‚ãÆ‚ãÆ</div>
             </div>
           </ng-container>

           <!-- –û–¢–õ–ê–î–ö–ê: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö -->
           <div class="debug-info" style="position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; font-size: 12px; z-index: 9999;">
             <div>–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {{ videoCallService.userId }}</div>
             <div>–†–æ–ª—å: {{ authService.getCurrentUser()?.currentRole || '–ù–ï –û–ü–†–ï–î–ï–õ–ï–ù–ê' }}</div>
             <div>isTeacher(): {{ isTeacher() }}</div>
             <div>–°—Ç—É–¥–µ–Ω—Ç—ã: {{ remoteUserIds.length }}</div>
             <div *ngFor="let uid of remoteUserIds">ID: {{ uid }}</div>
             <div>–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ PiP: {{ remoteUserIds[0] || '–ù–ï–¢' }}</div>
           </div>
         </div>
</div>
