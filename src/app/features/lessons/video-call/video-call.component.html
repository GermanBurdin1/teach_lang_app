<div class="video-call-container" [class.floating]="isFloatingMode" [class.screen-sharing-active]="isScreenSharing"
  (mousedown)="startDrag($event)">
  
  <!-- ОСНОВНОЕ ВИДЕО (удаленные пользователи) -->
  <div class="main-video-container" 
       [style.width.px]="videoWidth" 
       [style.height.px]="videoHeight"
       (mouseenter)="showVideoControls()" 
       (mouseleave)="hideVideoControls()">
    
    <!-- Если есть удаленные пользователи - показываем их -->
    <ng-container *ngIf="remoteUserIds.length > 0">
      <div class="remote-video-main" *ngFor="let uid of remoteUserIds; let first = first">
        <video *ngIf="first" 
               id="remote-video-{{ uid }}" 
               autoplay 
               playsinline 
               class="main-video-stream">
        </video>
        <div class="user-info">{{ uid }}</div>
      </div>
    </ng-container>
    
    <!-- Если нет удаленных пользователей - показываем свое видео -->
    <div *ngIf="remoteUserIds.length === 0" class="waiting-state">
      <video #localVideo autoplay playsinline class="main-video-stream"></video>
      <div class="waiting-message">Ожидание подключения других участников...</div>
    </div>

    <!-- Кнопки управления -->
    <div class="controls-overlay" *ngIf="showControls">
      <button class="control-btn" (click)="toggleCall()"
        title="{{ callActive ? 'Завершить звонок' : 'Возобновить звонок' }}">
        <i [class]="callActive ? 'fas fa-phone-slash' : 'fas fa-phone'"></i>
      </button>

      <button class="control-btn share-screen-btn" (click)="toggleScreenSharing()"
        title="{{ isScreenSharing ? 'Остановить демонстрацию' : 'Демонстрация экрана' }}">
        <i [class]="isScreenSharing ? 'fas fa-stop-circle' : 'fas fa-desktop'"></i>
      </button>
    </div>

    <!-- Область для изменения размера -->
    <div class="resize-handle" (mousedown)="startResize($event)"></div>
  </div>

  <!-- МАЛЕНЬКОЕ ЛОКАЛЬНОЕ ВИДЕО (picture-in-picture) -->
  <div class="local-video-pip" *ngIf="remoteUserIds.length > 0">
    <video #localVideoPip autoplay playsinline muted class="pip-video-stream"></video>
    <div class="pip-label">Вы</div>
  </div>
</div>
