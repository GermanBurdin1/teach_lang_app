<div class="lesson-management" *ngIf="!activeLesson">

  <!-- === FILTRES + LEÃ‡ONS === -->
  <div *ngIf="activePanel === 'cours'">

    <!-- ğŸ” Filtres -->
    <div class="filter-container mat-elevation-z1">
      <mat-button-toggle-group [(ngModel)]="filter" name="period" (change)="recalculateStatus()">
        <mat-button-toggle value="future">ğŸ“… Ã€ venir</mat-button-toggle>
        <mat-button-toggle value="past">ğŸ•“ PassÃ©s</mat-button-toggle>
        <mat-button-toggle value="all">ğŸ“š Tous</mat-button-toggle>
      </mat-button-toggle-group>

      <mat-form-field appearance="fill" class="filter-item">
        <mat-label>ğŸ‘©â€ğŸ“ Ã‰tudiant</mat-label>
        <mat-select [(ngModel)]="selectedStudent">
          <mat-option value="">Tous les Ã©tudiants</mat-option>
          <mat-option *ngFor="let s of uniqueStudents" [value]="s">{{ s }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-item">
        <mat-label>Date de dÃ©but</mat-label>
        <input matInput type="date" [(ngModel)]="startDate">
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-item">
        <mat-label>Date de fin</mat-label>
        <input matInput type="date" [(ngModel)]="endDate">
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-item keyword">
        <mat-label>Mot-clÃ©</mat-label>
        <input matInput [(ngModel)]="searchTerm" placeholder="ğŸ” tÃ¢ches, textes, etc.">
      </mat-form-field>
    </div>

    <!-- ğŸ“¦ Liste des cours -->
    <div class="lesson-list">
      <app-teacher-lesson-card *ngFor="let lesson of filteredLessons" [lesson]="lesson" [lessonId]="lesson.id"
        [taskDropIds]="taskDropIds" [resolvedItems]="resolvedItemsPerLesson[lesson.id] || []"
        (itemDropped)="onItemDropped($event)" (openGabarit)="openGabarit(lesson)">
      </app-teacher-lesson-card>
      <div class="paginator-wrapper" *ngIf="activePanel === 'cours'">
        <mat-paginator [length]="fullFilteredLessons.length" [pageSize]="pageSize" [pageSizeOptions]="[4, 8, 12]"
          (page)="onPageChange($event)" [showFirstLastButtons]="true" aria-label="Pagination des cours">
        </mat-paginator>
      </div>

      <div *ngIf="filteredLessons.length < fullFilteredLessons.length" class="text-center mt-3">
        <button mat-stroked-button color="primary" (click)="loadMore()">Afficher plus</button>
      </div>
    </div>

  </div>


  <div *ngIf="activePanel === 'settings'" class="lesson-list p-3">
    <h3>âš™ï¸ ParamÃ¨tres</h3>
    <p class="text-muted">Zone de configuration (Ã  dÃ©finir)...</p>
  </div>

  <div *ngIf="activePanel === 'stats'" class="lesson-list p-3">
    <h3>ğŸ“ˆ Statistiques globales</h3>

    <ul class="mb-3">
      <li>Cours passÃ©s : {{ pastLessonsCount }}</li>
      <li>Cours Ã  venir : {{ futureLessonsCount }}</li>
      <li>Ã‰tudiants uniques : {{ uniqueStudents.length }}</li>
    </ul>

    <h4>ğŸ¯ Objectifs</h4>
    <p class="text-muted">DÃ©finir des objectifs Ã  long terme ici...</p>
  </div>


  <!-- â¬…ï¸ Ğ¡Ğ°Ğ¹Ğ´Ğ±Ğ°Ñ€ -->
  <div class="side-tabs-wrapper" (mouseenter)="hideTabs = false" (mouseleave)="hideTabs = true">
    <div class="side-tabs">
      <div class="tab-button" (click)="activePanel = 'cours'" [class.active]="activePanel === 'cours'"
        [class.expanded]="!hideTabs">
        ğŸ“‹ <span class="label" *ngIf="!hideTabs">Cours</span>
      </div>
      <div class="tab-button" (click)="activePanel = 'stats'" [class.active]="activePanel === 'stats'"
        [class.expanded]="!hideTabs">
        ğŸ“ˆ <span class="label" *ngIf="!hideTabs">Statistiques</span>
      </div>
      <div class="tab-button" (click)="activePanel = 'settings'" [class.active]="activePanel === 'settings'"
        [class.expanded]="!hideTabs">
        âš™ï¸ <span class="label" *ngIf="!hideTabs">ParamÃ¨tres</span>
      </div>


    </div>
  </div>
</div>

<!-- Ğ“Ğ°Ğ±Ğ°Ñ€Ğ¸Ñ‚ -->
<app-gabarit *ngIf="activeLesson" [lesson]="activeLesson" [visible]="true" [close]="closeGabarit.bind(this)">
</app-gabarit>
