<div class="lesson-management" *ngIf="!activeLesson">

  <!-- === FILTRES + LEÃ‡ONS === -->
  <div *ngIf="activePanel === 'cours'">

    <!-- ğŸ” Filtres -->
    <div class="filter-container mat-elevation-z1">
      <mat-button-toggle-group [(ngModel)]="filter" name="period" (change)="recalculateStatus()">
        <mat-button-toggle value="future">ğŸ“… Ã€ venir</mat-button-toggle>
        <mat-button-toggle value="past">ğŸ•“ PassÃ©s</mat-button-toggle>
      </mat-button-toggle-group>

      <mat-form-field appearance="fill" class="filter-item">
        <mat-label>ğŸ‘©â€ğŸ“ Ã‰tudiant</mat-label>
        <mat-select [(ngModel)]="selectedStudent">
          <mat-option value="">Tous les Ã©tudiants</mat-option>
          <mat-option *ngFor="let s of uniqueStudents" [value]="s">{{ s }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-item">
        <mat-label>Date de dÃ©but</mat-label>
        <input matInput type="date" [(ngModel)]="startDate">
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-item">
        <mat-label>Date de fin</mat-label>
        <input matInput type="date" [(ngModel)]="endDate">
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-item keyword">
        <mat-label>Mot-clÃ©</mat-label>
        <input matInput [(ngModel)]="searchTerm" placeholder="ğŸ” tÃ¢ches, textes, etc.">
      </mat-form-field>
    </div>

    <!-- ğŸ“¦ Liste des cours -->
    <div class="lesson-list">
      <app-teacher-lesson-card *ngFor="let lesson of filteredLessons" [lesson]="lesson" [lessonId]="lesson.id"
        [taskDropIds]="taskDropIds" [resolvedItems]="resolvedItemsPerLesson[lesson.id] || []"
        (itemDropped)="onItemDropped($event)" (openGabarit)="openGabarit(lesson)">
      </app-teacher-lesson-card>

      <div *ngIf="filteredLessons.length < fullFilteredLessons.length" class="text-center mt-3">
        <button mat-stroked-button color="primary" (click)="loadMore()">Afficher plus</button>
      </div>
    </div>

  </div>


  <div *ngIf="activePanel === 'homework'" class="lesson-list">
    <div class="homework-summary mt-4 p-3 border border-warning rounded bg-light">
      <h4 class="text-warning">ğŸ“š Devoirs Ã  faire</h4>
      <ul class="mb-0 ps-3">
        <li *ngFor="let hw of allHomework.concat(newHomeworkFromClass)" class="text-dark">
          {{ hw }}
        </li>
      </ul>
      <div *ngIf="!allHomework.length && !newHomeworkFromClass.length" class="text-muted">
        Aucun devoir assignÃ© pour lâ€™instant.
      </div>
    </div>
  </div>

  <!-- â¬…ï¸ Ğ¡Ğ°Ğ¹Ğ´Ğ±Ğ°Ñ€ -->
  <div class="side-tabs-wrapper" (mouseenter)="hideTabs = false" (mouseleave)="hideTabs = true">
    <div class="side-tabs">
      <div class="tab-button" (click)="activePanel = 'cours'" [class.active]="activePanel === 'cours'"
        [class.expanded]="!hideTabs">
        ğŸ“‹ <span class="label" *ngIf="!hideTabs">Cours</span>
      </div>
      <div class="tab-button" (click)="activePanel = 'homework'" [class.active]="activePanel === 'homework'"
        [class.expanded]="!hideTabs">
        ğŸ“š <span class="label" *ngIf="!hideTabs">Devoirs</span>
      </div>

    </div>
  </div>
</div>

<!-- Ğ“Ğ°Ğ±Ğ°Ñ€Ğ¸Ñ‚ -->
<app-gabarit *ngIf="activeLesson" [lesson]="activeLesson" [visible]="true" [close]="closeGabarit.bind(this)">
</app-gabarit>
