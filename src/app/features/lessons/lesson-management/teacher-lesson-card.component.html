<div class="lesson-card">
  <div class="lesson-header">
    <div class="info">
      ğŸ‘©â€ğŸ« {{ lesson.teacher || lesson.studentName || 'Ã‰tudiant' }} â€” {{ lesson.date || lesson.scheduledAt | date: 'dd/MM/yyyy' }}
    </div>
    
    <!-- Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ° ÑƒÑ€Ğ¾ĞºĞ° -->
    <div class="lesson-stats">
      <span class="stat-item">
        <mat-icon>assignment</mat-icon>
        {{ lesson.tasks?.length || 0 }} tÃ¢che(s)
      </span>
      <span class="stat-item">
        <mat-icon>quiz</mat-icon>
        {{ lesson.questions?.length || 0 }} question(s)
      </span>
      <span class="stat-item">
        <mat-icon>folder</mat-icon>
        {{ lesson.materials?.length || 0 }} matÃ©riau(x)
      </span>
    </div>

    <div class="lesson-actions">
      <button mat-stroked-button color="primary" (click)="openGabarit.emit()">
        â• Ajouter du matÃ©riel
      </button>

      <!-- ğŸ¥ ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ² Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ -->
      <button *ngIf="canEnterClass()" 
              mat-raised-button 
              color="accent" 
              (click)="enterVirtualClass()"
              class="enter-class-btn">
        ğŸ¥ Entrer en classe
      </button>
    </div>
  </div>

  <div class="drop-zone">
    <h4 (click)="toggleTasksCollapsed()" class="collapsible-header">
      ğŸ“Œ TÃ¢ches
      <span class="toggle-icon">{{ collapsedTasks ? 'ğŸ”½' : 'ğŸ”¼' }}</span>
    </h4>
    <div *ngIf="!collapsedTasks">
      <div cdkDropList [id]="'tasks-' + lesson.id" [cdkDropListData]="lesson.tasks"
        [cdkDropListConnectedTo]="taskDropIds" (cdkDropListDropped)="dropItem($event)">
        <div *ngFor="let task of lesson.tasks; let i = index" cdkDrag class="drag-item"
          [class.text-muted]="resolvedItems.includes(task)">
          {{ i + 1 }}. ğŸ›  {{ task }}
          <button mat-icon-button color="warn" (click)="removeTask(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>

      <div class="add-item" *ngIf="lesson.status !== 'past'">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Ajouter une tÃ¢che</mat-label>
          <input matInput placeholder="ex: Corriger l'expression Ã©crite de l'Ã©lÃ¨ve" [(ngModel)]="newTask"
            (keydown.enter)="addTask()">
        </mat-form-field>
        <button mat-icon-button color="primary" (click)="addTask()" [disabled]="!newTask || !newTask.trim()">
          <mat-icon>add</mat-icon>
        </button>
      </div>
    </div>
  </div>


</div>
