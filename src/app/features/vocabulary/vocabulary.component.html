<div class="vocabulary-container">
  <h1>{{ currentSubtopic }}
  </h1>

  <!-- –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
  <div class="filters-controls-section">
    <!-- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É -->
    <div class="filter-group">
      <label>Type :</label>
      <div class="filter-type-buttons">
        <button (click)="filterType = 'all'" [class.active]="filterType === 'all'">Tous</button>
        <button (click)="filterType = 'word'" [class.active]="filterType === 'word'">Mots</button>
        <button (click)="filterType = 'expression'" [class.active]="filterType === 'expression'">Expressions</button>
      </div>
    </div>

    <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
    <div class="filter-group">
      <label>Trier par :</label>
      <mat-form-field class="sort-select-field" appearance="outline">
        <mat-select [(ngModel)]="sortBy" (selectionChange)="sortWords()" name="sortBy">
          <mat-option value="all">
            <i class="fas fa-layer-group"></i> Tous
          </mat-option>
          <mat-option value="repeat">
            <i class="fas fa-sync-alt"></i> R√©viser
          </mat-option>
          <mat-option value="learned">
            <i class="fas fa-check-circle"></i> Appris
          </mat-option>
          <mat-option value="untranslated">
            <i class="fas fa-question-circle"></i> Sans traduction
          </mat-option>
          <mat-option value="hardest">
            <i class="fas fa-fire"></i> Erreurs
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∞ -->
    <div class="filter-group">
      <label>Vue :</label>
      <div class="view-toggle-switch">
        <button (click)="viewMode = 'cards'" [class.active]="viewMode === 'cards'" aria-label="Cartes" matTooltip="Vue en cartes" matTooltipClass="galaxy-tooltip">
          üìá
        </button>
        <button (click)="viewMode = 'list'" [class.active]="viewMode === 'list'" aria-label="En liste" matTooltip="Vue en liste" matTooltipClass="galaxy-tooltip">
          üìã
        </button>
      </div>
    </div>
  </div>

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ -->
  <div class="cards-container" [ngClass]="{
    'single-column': filterType !== 'all',
    'two-columns': filterType === 'all'
  }">
    <!-- –ö–æ–ª–æ–Ω–∫–∞ –¥–ª—è —Å–ª–æ–≤ -->
    <div class="column" *ngIf="filterType === 'all' || filterType === 'word'">
      <div class="controls-row">
        <button class="add-icon-btn" (click)="openAddCardModal('word')" matTooltip="Ajouter un mot" matTooltipClass="galaxy-tooltip">
          <i class="fas fa-plus"></i>
        </button>
        <button class="sort-toggle-btn" (click)="toggleSortOrderWords()"
          [matTooltip]="'D\'abord ' + (sortOrderWords === 'desc' ? 'nouveaux' : 'anciens')" 
          matTooltipClass="galaxy-tooltip">
          <i class="fas" [ngClass]="sortOrderWords === 'desc' ? 'fa-arrow-down' : 'fa-arrow-up'"></i>
        </button>
        <button class="lang-sort-btn" (click)="sortByLang = !sortByLang; sortWords()" [class.active]="sortByLang"
          matTooltip="Trier par langue" matTooltipClass="galaxy-tooltip">
          üåç
        </button>
      </div>

      <h3>
        <div class="pagination-info">
          {{ wordsRangeLabel }}
        </div>
      </h3>
      <ng-container *ngIf="viewMode === 'cards'; else wordList">
        <div *ngFor="let card of paginatedWords" class="card-wrapper" [ngClass]="{
          'card-wrapper--repeat': sortBy === 'repeat' && card.status === 'repeat',
          'card-wrapper--learned': sortBy === 'learned' && card.status === 'learned',
          'card-wrapper--untranslated': sortBy === 'untranslated' && (!card.translations[0] || card.translations[0].target === '...')

        }">
          <div class="card">
            <div class="card-inner" [class.flipped]="card.flipped">
              <div class="card-front" [ngClass]="{
                'card-front--repeat': card.status === 'repeat',
                'card-front--learned': card.status === 'learned',
                'card-front--untranslated': !card.translations[0] || card.translations[0].target === '...'
              }">
                <div class="card-icon" *ngIf="sortBy === 'repeat' && card.status === 'repeat'">
                  <i class="fas fa-sync-alt" matTooltip="√Ä r√©viser" matTooltipClass="galaxy-tooltip"></i>
                </div>
                <div class="card-icon" *ngIf="sortBy === 'learned' && card.status === 'learned'">
                  <i class="fas fa-check-circle" matTooltip="Appris" matTooltipClass="galaxy-tooltip"></i>
                </div>
                <div class="card-icon"
                  *ngIf="sortBy === 'untranslated' && (!card.translations[0] || card.translations[0].target === '...')">
                  <i class="fas fa-question-circle" matTooltip="Pas de traduction" matTooltipClass="galaxy-tooltip"></i>
                </div>
                <div class="card-header">
                  <p class="date-label">
                    üìÖ {{ card.createdAt | date:'dd/MM/yyyy' }}
                  </p>
                  <button class="delete-btn" (click)="deleteItem(card.id, 'word'); $event.stopPropagation()">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </div>
                <div class="card-body">
                  <p>
                    {{ card.word }}
                    <span class="grammar-badge" *ngIf="card.grammar">
                      {{ getGrammarBadge(card.grammar) }}
                    </span>
                  </p>
                  <span *ngIf="card.hintVisible">
                    <span *ngIf="card.translations?.[0]?.target === '...' || !card.translations[0]"
                      class="hint untranslated" (click)="openTranslationForm(card, true)">
                      Ajouter une traduction
                    </span>
                    <span *ngIf="card.translations[0] && card.translations[0].target !== '...'" class="hint" (click)="flipCard(card); $event.stopPropagation()">
                      Clique pour voir la traduction
                    </span>
                  </span>
                </div>
                <button class="flip-btn" (click)="flipCard(card); $event.stopPropagation()">
                  <i class="fas fa-retweet"></i>
                </button>
              </div>
              <div class="card-back">
                <div class="btn-group" *ngIf="!card.isCorrect && !card.showTranslation">
                  <button
                    *ngIf="card.translations[0] && !card.showTranslation && (card.hintIndex ?? 0) < card.translations[0].target.length - 1"
                    (click)="revealNextHint(card); $event.stopPropagation()">
                    {{ card.hintIndex ? 'Encore un indice' : 'Obtenir un indice' }}
                  </button>

                  <button *ngIf="!card.showTranslation" (click)="showFullTranslation(card); $event.stopPropagation()">
                    Montrer le mot
                  </button>

                  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–ª—è–º -->
                  <button *ngIf="card.type === 'word'" 
                    (click)="openGrammarModal(card); $event.stopPropagation()"
                    class="grammar-details-btn">
                    üìù Grammaire
                  </button>
                  
                  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏ -->
                  <button 
                    (click)="toggleEnlargedCard(card, 0); $event.stopPropagation()"
                    class="expand-details-btn">
                    {{ enlargedCardId === card.id ? '‚Ü© Fermer actions' : '‚öôÔ∏è Actions' }}
                  </button>

                  <input [(ngModel)]="card.userInput" (keyup.enter)="checkTranslation(card)" placeholder="Saisir la traduction"
                    class="input-field" />
                </div>

                <div *ngIf="(card.isCorrect === true || card.showTranslation) && !card.status" class="after-guess-btns">
                  <button (click)="markAsLearned(card); $event.stopPropagation()">Je connais ce mot</button>
                  <button (click)="markForRepetition(card); $event.stopPropagation()">R√©viser plus tard</button>
                </div>
                <div *ngIf="card.status === 'learned'" class="after-guess-btns">
                  <button (click)="resetToPractice(card); $event.stopPropagation()">Cacher √† nouveau la traduction</button>
                </div>


                <div class="card-show-translation" *ngIf="card.showTranslation">

                  <div class="translation-entry" *ngFor="let t of card.translations; let i = index">
                    <p>{{ t.target }}</p>
                    
                    <div class="translation-entry__button-row">
                      <!-- Boutons d'actions √† gauche du bouton grammaire -->
                      <div class="translation-entry__actions" *ngIf="enlargedCardId === card.id">
                        <button class="more-info-tooltip-btn" *ngIf="editingCard" (click)="openAddMeaningModal(editingCard); $event.stopPropagation()">
                          <i class="fas fa-plus-circle"></i>
                          <span class="tooltip-text">Ajouter une signification</span>
                        </button>
                        <button class="more-info-tooltip-btn" (click)="openExampleModal(); $event.stopPropagation()">
                          <i class="fas fa-plus"></i>
                          <span class="tooltip-text">Exemple</span>
                        </button>
                        <button class="more-info-tooltip-btn" (click)="openExtraTranslationModal(); $event.stopPropagation()">
                          <i class="fas fa-language"></i>
                          <span class="tooltip-text">Traduction</span>
                        </button>
                        <button class="more-info-tooltip-btn" (click)="viewExamples(); $event.stopPropagation()">
                          <i class="fas fa-eye"></i>
                          <span class="tooltip-text">Exemples</span>
                        </button>
                        <button class="more-info-tooltip-btn" (click)="viewTranslations(); $event.stopPropagation()">
                          <i class="fas fa-eye"></i>
                          <span class="tooltip-text">Traductions</span>
                        </button>
                      </div>
                      
                      <div class="translation-entry__controls">
                        <button class="translation-entry__more-button"
                          (click)="toggleEnlargedCard(card, i); $event.stopPropagation()">
                          {{ enlargedCardId === card.id ? '‚Ü© mode normal' : 'actions' }}
                        </button>
                        
                        <button *ngIf="card.type === 'word'" class="translation-entry__grammar-button"
                          (click)="openGrammarModal(card); $event.stopPropagation()">
                          üìù
                        </button>
                      </div>
                    </div>

                  </div>

                </div>

                <p *ngIf="!card.showTranslation && (card.hintIndex ?? 0) > 0" class="hint-display">
                  {{ getHint(card) }}
                </p>

                <span *ngIf="card.isCorrect === true" class="correct">‚úîÔ∏è</span>
                <span *ngIf="card.isCorrect === false" class="wrong">‚ùå</span>

                <!-- Les champs grammaticaux sont maintenant dans une modalka s√©par√©e -->

                <button class="flip-btn" (click)="flipCard(card); $event.stopPropagation()">
                  <i class="fas fa-retweet"></i>
                </button>

              </div>


            </div>
          </div>
        </div>
      </ng-container>

      <ng-template #wordList>
        <ul class="word-list">
          <li *ngFor="let word of paginatedWords">
            <strong>{{ word.word }}</strong> ‚Üí {{ word.translations[0] || '...' }}
          </li>
        </ul>
      </ng-template>

      <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è —Å–ª–æ–≤ -->
      <div class="pagination-controls">
        <button (click)="changeWordsPage(-1)" [disabled]="!hasPrevWordsPage">‚¨Ö</button>
        <span>Page {{ currentWordsPage }}</span>
        <button (click)="changeWordsPage(1)" [disabled]="!hasNextWordsPage">‚û°</button>
      </div>

    </div>
    <!-- –ö–æ–ª–æ–Ω–∫–∞ –¥–ª—è –≤—ã—Ä–∞–∂–µ–Ω–∏–π -->
    <div class="column" *ngIf="filterType === 'all' || filterType === 'expression'">
      <div class="controls-row">
        <button class="add-icon-btn" (click)="openAddCardModal('expression')" matTooltip="Ajouter une expression" matTooltipClass="galaxy-tooltip"
          aria-label="Ajouter une expression">
          <i class="fas fa-plus"></i>
        </button>
        <button class="sort-toggle-btn" (click)="toggleSortOrderExpressions()"
          [matTooltip]="'D\'abord ' + (sortOrderExpressions === 'desc' ? 'nouvelles' : 'anciennes')" 
          matTooltipClass="galaxy-tooltip">
          <i class="fas" [ngClass]="sortOrderExpressions === 'desc' ? 'fa-arrow-down' : 'fa-arrow-up'"></i>
        </button>
        <button class="lang-sort-btn" (click)="sortByLang = !sortByLang; sortWords()" [class.active]="sortByLang"
          matTooltip="Trier par langue" matTooltipClass="galaxy-tooltip">
          üåç
        </button>
      </div>
      <h3>
        <div class="pagination-info">
          {{ expressionsPaginationLabel }}
        </div>
      </h3>
      <ng-container *ngIf="viewMode === 'cards'; else expressionList">
        <div *ngFor="let card of paginatedExpressions" class="card-wrapper" [ngClass]="{
          'card-wrapper--repeat': sortBy === 'repeat' && card.status === 'repeat',
          'card-wrapper--learned': sortBy === 'learned' && card.status === 'learned',
          'card-wrapper--untranslated': sortBy === 'untranslated' && (!card.translations[0] || card.translations[0].target === '...')
        }">
          <div class="card">
            <div class="card-inner" [class.flipped]="card.flipped">
              <div class="card-front" [ngClass]="{
                'card-front--repeat': card.status === 'repeat',
                'card-front--learned': card.status === 'learned',
                'card-front--untranslated': !card.translations[0] || card.translations[0].target === '...'
              }">
                <div class="card-header">
                  <p class="date-label">
                    üìÖ {{ card.createdAt | date:'dd/MM/yyyy' }}
                  </p>
                  <button class="delete-btn" (click)="deleteItem(card.id, 'expression'); $event.stopPropagation()">
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </div>
                <div class="card-body">
                  <p>{{ card.word }}</p>
                  <span *ngIf="card.hintVisible" class="hint">Clique pour voir la traduction</span>
                </div>
                <button class="flip-btn" (click)="flipCard(card); $event.stopPropagation()">
                  <i class="fas fa-retweet"></i>
                </button>
              </div>
              <div class="card-back">
                <div class="card-show-translation" *ngIf="card.showTranslation">
                  <div class="translation-entry" *ngFor="let t of card.translations; let i = index">
                    <p>{{ t.target }}</p>
                    
                    <div class="translation-entry__button-row">
                      <!-- Boutons d'actions √† gauche du bouton grammaire -->
                      <div class="translation-entry__actions" *ngIf="enlargedCardId === card.id">
                        <button class="more-info-tooltip-btn" *ngIf="editingCard" (click)="openAddMeaningModal(editingCard); $event.stopPropagation()">
                          <i class="fas fa-plus-circle"></i>
                          <span class="tooltip-text">Ajouter une signification</span>
                        </button>
                        <button class="more-info-tooltip-btn" (click)="openExampleModal(); $event.stopPropagation()">
                          <i class="fas fa-plus"></i>
                          <span class="tooltip-text">Exemple</span>
                        </button>
                        <button class="more-info-tooltip-btn" (click)="openExtraTranslationModal(); $event.stopPropagation()">
                          <i class="fas fa-language"></i>
                          <span class="tooltip-text">Traduction</span>
                        </button>
                        <button class="more-info-tooltip-btn" (click)="viewExamples(); $event.stopPropagation()">
                          <i class="fas fa-eye"></i>
                          <span class="tooltip-text">Exemples</span>
                        </button>
                        <button class="more-info-tooltip-btn" (click)="viewTranslations(); $event.stopPropagation()">
                          <i class="fas fa-eye"></i>
                          <span class="tooltip-text">Traductions</span>
                        </button>
                      </div>
                      
                      <div class="translation-entry__controls">
                        <button class="translation-entry__more-button"
                          (click)="toggleEnlargedCard(card, i); $event.stopPropagation()">
                          {{ enlargedCardId === card.id ? '‚Ü© mode normal' : 'actions' }}
                        </button>
                        
                        <button *ngIf="card.type === 'word'" class="translation-entry__grammar-button"
                          (click)="openGrammarModal(card); $event.stopPropagation()">
                          üìù
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- –ì–†–ê–ú–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –î–ê–ù–ù–´–ï -->
                <div class="grammar-details" *ngIf="card.grammar && card.showTranslation">
                  <ng-container [ngSwitch]="card.grammar.partOfSpeech">

                    <!-- –°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ -->
                    <ng-container *ngIf="getNounGrammar(card) as noun">
                      <p>Genre : {{ noun.gender || 'non sp√©cifi√©' }}</p>
                      <p>Nombre : {{ noun.number || 'non sp√©cifi√©' }}</p>
                      <p>Nom propre : {{ noun.isProper ? 'oui' : 'non' }}</p>
                    </ng-container>

                    <!-- –ì–ª–∞–≥–æ–ª -->
                    <ng-container *ngIf="getVerbGrammar(card) as verb">
                      <p>Transitivit√© : {{ verb.transitivity || 'non sp√©cifi√©e' }}</p>
                      <p>Pronominal : {{ verb.isPronominal ? 'oui' : 'non' }}</p>
                      <p>Irr√©gulier : {{ verb.isIrregular ? 'oui' : 'non' }}</p>
                    </ng-container>

                    <!-- –ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ -->
                    <ng-container *ngIf="getAdjectiveGrammar(card) as adj">
                      <p>Degr√© de comparaison : {{ adj.comparison || 'non sp√©cifi√©' }}</p>
                      <p>Variable : {{ adj.variable ? 'oui' : 'non' }}</p>
                    </ng-container>

                    <!-- –ù–∞—Ä–µ—á–∏–µ -->
                    <ng-container *ngIf="getAdverbGrammar(card) as adv">
                      <p>Degr√© de comparaison : {{ adv.comparison || 'non sp√©cifi√©' }}</p>
                    </ng-container>

                    <!-- –ú–µ—Å—Ç–æ–∏–º–µ–Ω–∏–µ -->
                    <ng-container *ngIf="getPronounGrammar(card) as pron">
                      <p>Personne : {{ pron.person || 'non sp√©cifi√©e' }}</p>
                      <p>Genre : {{ pron.gender || 'non sp√©cifi√©' }}</p>
                      <p>Nombre : {{ pron.number || 'non sp√©cifi√©' }}</p>
                      <p>Type : {{ pron.type || 'non sp√©cifi√©' }}</p>
                    </ng-container>

                    <!-- –°–æ—é–∑ -->
                    <ng-container *ngIf="getConjunctionGrammar(card) as conj">
                      <p>Type : {{ conj.type || 'non sp√©cifi√©' }}</p>
                    </ng-container>

                    <!-- –ú–µ–∂–¥–æ–º–µ—Ç–∏–µ -->
                    <ng-container *ngIf="getInterjectionGrammar(card) as interj">
                      <p>Type d'√©motion : {{ interj.emotionType || 'non sp√©cifi√©' }}</p>
                    </ng-container>

                    <!-- –í—ã—Ä–∞–∂–µ–Ω–∏–µ -->
                    <ng-container *ngIf="getExpressionGrammar(card) as expr">
                      <p>Type d'expression : {{ expr.expressionType || 'non sp√©cifi√©' }}</p>
                      <p>Origine : {{ expr.origin || 'non sp√©cifi√©e' }}</p>
                    </ng-container>

                  </ng-container>
                </div>

                <div class="btn-group" *ngIf="!card.isCorrect && !card.showTranslation">
                  <button *ngIf="!card.showTranslation && (card.hintIndex ?? 0) < card.translations.length - 1"
                    (click)="revealNextHint(card); $event.stopPropagation()">
                    {{ card.hintIndex ? 'Encore un indice' : 'Obtenir un indice' }}
                  </button>

                  <button *ngIf="!card.showTranslation" (click)="showFullTranslation(card); $event.stopPropagation()">
                    Montrer le mot
                  </button>

                  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–ª—è–º (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª–æ–≤) -->
                  <button *ngIf="card.type === 'word'" 
                    (click)="openGrammarModal(card); $event.stopPropagation()"
                    class="grammar-details-btn">
                    üìù Grammaire
                  </button>
                  
                  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏ -->
                  <button 
                    (click)="toggleEnlargedCard(card, 0); $event.stopPropagation()"
                    class="expand-details-btn">
                    {{ enlargedCardId === card.id ? '‚Ü© Fermer actions' : '‚öôÔ∏è Actions' }}
                  </button>

                  <input [(ngModel)]="card.userInput" (keyup.enter)="checkTranslation(card)" placeholder="Saisir la traduction"
                    class="input-field" />
                </div>

                <div *ngIf="(card.isCorrect === true || card.showTranslation) && !card.status" class="after-guess-btns">
                  <button (click)="markAsLearned(card); $event.stopPropagation()">Je connais ce mot</button>
                  <button (click)="markForRepetition(card); $event.stopPropagation()">R√©viser plus tard</button>
                </div>


                <p *ngIf="!card.showTranslation && (card.hintIndex ?? 0) > 0" class="hint-display">
                  {{ getHint(card) }}
                </p>

                <span *ngIf="card.isCorrect === true" class="correct">‚úîÔ∏è</span>
                <span *ngIf="card.isCorrect === false" class="wrong">‚ùå</span>

                <button class="flip-btn" (click)="flipCard(card); $event.stopPropagation()">
                  <i class="fas fa-retweet"></i>
                </button>
              </div>


            </div>
          </div>

        </div>
      </ng-container>

      <ng-template #expressionList>
        <ul class="word-list">
          <li *ngFor="let expr of paginatedExpressions">
            <strong>{{ expr.word }}</strong> ‚Üí {{ expr.translations }}
          </li>
        </ul>
      </ng-template>

      <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –≤—ã—Ä–∞–∂–µ–Ω–∏–π -->
      <div class="pagination-controls">
        <button (click)="changeExpressionsPage(-1)" [disabled]="!hasPrevExpressionsPage">‚¨Ö</button>
        <span>Page {{ currentExpressionsPage }}</span>
        <button (click)="changeExpressionsPage(1)" [disabled]="!hasNextExpressionsPage">‚û°</button>
      </div>


    </div>
  </div>

</div>

<!-- –°—Ç–∞—Ä–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ Material Dialog –≤ –¥–æ–±–∞–≤–∏—Ç—å-—Å–ª–æ–≤–æ-–¥–∏–∞–ª–æ–≥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ -->

<!-- –ú–æ–¥–∞–ª–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –¥–ª—è –Ω–µ–ø–µ—Ä–µ–≤–µ–¥—ë–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏ -->
<div class="translation-modal-overlay"
  *ngIf="editingCard && manualTranslation !== '' && !showExtraModal && !showExtraTranslationModal">
  <div class="translation-modal">
    <button class="close-btn" (click)="cancelTranslationEdit()" aria-label="Fermer">
      <i class="fas fa-times"></i>
    </button>
    <h2>Ajouter une traduction</h2>
    <p><strong>{{ editingCard.word }}</strong></p>
    <div class="input-group">
      <input [(ngModel)]="manualTranslation" placeholder="Entrer la traduction manuellement" />
    </div>

    <div class="modal-actions">
      <button (click)="saveManualTranslation()">Sauvegarder</button>
      <button (click)="requestTranslation(editingCard)">üåê Traduire</button>
      <button (click)="cancelTranslationEdit()">Annuler</button>
    </div>
  </div>
</div>

<!-- Modale d'exemple avec style de grammaire -->
<div *ngIf="showExtraModal" class="grammar-modal-overlay" (click)="closeExtraModal()">
  <div class="grammar-modal-content" (click)="$event.stopPropagation()">
    <div class="grammar-modal-header">
      <div class="grammar-modal-title">
        <div class="grammar-modal-icon">üìù</div>
        <div class="grammar-modal-text">
          <h2>Ajouter un exemple</h2>
        </div>
      </div>
      <button class="close-btn" (click)="closeExtraModal()">‚úñ</button>
    </div>
    
    <div class="grammar-modal-body">
      <input class="grammar-modal-input" [(ngModel)]="newExample" placeholder="Entrer un exemple" />
      
      <ul *ngIf="selectedTranslation" class="examples-list">
        <li *ngFor="let e of selectedTranslation.examples || []">{{ e }}</li>
      </ul>
    </div>
    
    <div class="grammar-modal-footer">
      <button class="btn-primary" (click)="addExample()">Ajouter</button>
      <button class="btn-secondary" (click)="closeExtraModal()">Fermer</button>
    </div>
  </div>
</div>

<!-- Modale d'ajout de signification avec style de grammaire -->
<div *ngIf="showAddMeaningModal" class="grammar-modal-overlay" (click)="cancelAddMeaning()">
  <div class="grammar-modal-content" (click)="$event.stopPropagation()">
    <div class="grammar-modal-header">
      <div class="grammar-modal-title">
        <div class="grammar-modal-icon">‚ú®</div>
        <div class="grammar-modal-text">
          <h2>Ajouter une signification</h2>
          <h3 *ngIf="selectedCard">pour "{{ selectedCard.word }}"</h3>
        </div>
      </div>
      <button class="close-btn" (click)="cancelAddMeaning()">‚úñ</button>
    </div>
    
    <div class="grammar-modal-body">
      <input class="grammar-modal-input" [(ngModel)]="newMeaningWord" placeholder="Nouvelle signification du mot">

      <mat-form-field class="grammar-modal-field" appearance="outline">
        <mat-label>Galaxie</mat-label>
        <mat-select [(ngModel)]="newMeaningGalaxy" (selectionChange)="onMeaningGalaxyChange()">
          <mat-option *ngFor="let galaxy of availableGalaxies" [value]="galaxy">{{ galaxy }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="grammar-modal-field" appearance="outline">
        <mat-label>Sous-th√®me</mat-label>
        <mat-select [(ngModel)]="newMeaningSubtopic">
          <mat-option *ngFor="let sub of availableSubtopics" [value]="sub">{{ sub }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    
    <div class="grammar-modal-footer">
      <button class="btn-primary" (click)="saveNewMeaning()">Sauvegarder</button>
      <button class="btn-secondary" (click)="cancelAddMeaning()">Annuler</button>
    </div>
  </div>
</div>

<!-- Modale de traduction suppl√©mentaire avec style de grammaire -->
<div *ngIf="showExtraTranslationModal" class="grammar-modal-overlay" (click)="closeExtraTranslationModal()">
  <div class="grammar-modal-content" (click)="$event.stopPropagation()">
    <div class="grammar-modal-header">
      <div class="grammar-modal-title">
        <div class="grammar-modal-icon">üåê</div>
        <div class="grammar-modal-text">
          <h2>Ajouter une traduction</h2>
        </div>
      </div>
      <button class="close-btn" (click)="closeExtraTranslationModal()">‚úñ</button>
    </div>
    
    <div class="grammar-modal-body">
      <input class="grammar-modal-input" [(ngModel)]="newTranslation" placeholder="Entrer une nouvelle traduction" />
      
      <ul *ngIf="editingCard?.translations" class="translations-list">
        <li *ngFor="let translation of editingCard!.translations">{{ translation.target }}</li>
      </ul>
    </div>
    
    <div class="grammar-modal-footer">
      <button class="btn-primary" (click)="addExtraTranslation()">Ajouter</button>
      <button class="btn-secondary" (click)="closeExtraTranslationModal()">Fermer</button>
    </div>
  </div>
</div>

<!-- Modalka pour les champs grammaticaux -->
<div *ngIf="showGrammarModal" class="grammar-modal-overlay" (click)="closeGrammarModal()">
  <div class="grammar-modal-content" (click)="$event.stopPropagation()">
    <div class="grammar-modal-header">
      <div class="grammar-modal-title">
        <div class="grammar-modal-icon">‚öóÔ∏è</div>
        <div class="grammar-modal-text">
          <h2>Informations grammaticales</h2>
          <h3 *ngIf="grammarModalCard">du mot <span class="highlighted-word">{{ grammarModalCard.word }}</span></h3>
        </div>
      </div>
      <button class="close-btn" (click)="closeGrammarModal()">‚úñ</button>
    </div>
    
    <div class="grammar-modal-body">
      <app-grammar-fields 
        *ngIf="grammarModalCard && grammarModalCard.type === 'word'"
        [grammar]="grammarModalCard.grammar"
        (grammarValidate)="onGrammarValidate(grammarModalCard)">
      </app-grammar-fields>
      
      <div *ngIf="grammarModalCard && grammarModalCard.type === 'expression'" class="expression-info">
        <p>üó£Ô∏è Les expressions n'ont pas de champs grammaticaux sp√©cifiques.</p>
        <p>Type: Expression</p>
      </div>
    </div>
    
    <div class="grammar-modal-footer">
      <button class="btn-secondary" (click)="closeGrammarModal()">Fermer</button>
    </div>
  </div>
</div>
