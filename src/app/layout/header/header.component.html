<nav class="navbar navbar-expand-lg navbar-light bg-light" *ngIf="!isLessonMaterialRoute">
  <!-- supprimé l'ancien header déroulant - déplacé dans le menu dropdown -->

  <div class="container-fluid d-flex justify-content-end align-items-center">
    <!-- Dropdown pour l'aide -->
    <!-- <div *ngIf="!loggedInAsAdminAccount" class="dropdown mx-2">
      <button class="btn btn-outline-primary dropdown-toggle d-flex align-items-center" type="button" id="helpDropdown"
        data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-rocket me-2"></i> Assistance
      </button>
      <div class="dropdown-menu dropdown-menu-end p-3" aria-labelledby="helpDropdown"
        style="width: 250px; border-radius: 8px;">
        <h6 class="mb-3 d-flex align-items-center">
          <i class="fas fa-school me-2 text-primary"></i> С чего начать
        </h6>
        <ul class="list-unstyled mb-0">
          <li><a class="dropdown-item" href="#" (click)="openTourModal(); $event.preventDefault()">Демо-тур</a></li>
          <li><a class="dropdown-item" href="/youtube-channel">YouTube-канал</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="/support">Техподдержка</a></li>
        </ul>
      </div>
    </div> -->

    <!-- Modal du tour guidé -->
    <!-- <div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': isTourModalOpen }"
      style="background-color: rgba(0, 0, 0, 0.5);" *ngIf="isTourModalOpen">
      <div class="modal-dialog modal-dialog-centered"
        [ngStyle]="{ position: modalPosition, top: modalTop, left: modalLeft }">
        <div class="modal-content p-4">
          <div class="modal-header">
            <h5 class="modal-title">{{ tourSteps[currentStep].title }}</h5>
            <button type="button" class="btn-close" aria-label="Close" (click)="closeTourModal()"></button>
          </div>
          <div class="modal-body">
            <p>{{ tourSteps[currentStep].content }}</p>
          </div>
          <div class="modal-footer d-flex justify-content-between">
            <div>
              <!-- Bouton "Retour" visible seulement à partir de la deuxième étape -->
              <!-- <button *ngIf="currentStep > 0" class="btn btn-secondary" (click)="previousStep()">Назад</button>
            </div>
            <div>
              <!-- Affichage de l'étape actuelle et du nombre total d'étapes -->
              <!-- <span>{{ currentStep + 1 }} из {{ tourSteps.length }}</span>
              <!-- Bouton "Suivant" -->
              <!-- <button *ngIf="currentStep < tourSteps.length - 1" class="btn btn-primary"
                (click)="nextStep()">Далее</button>
              <!-- Bouton "Terminer" à la dernière étape -->
              <!-- <button *ngIf="currentStep === tourSteps.length - 1" class="btn btn-primary"
                (click)="closeTourModal()">Завершить</button>
            </div>
          </div>
        </div>
      </div>
    </div> -->

    <!-- Dropdown pour les informations sur le tarif -->
    <!-- <div *ngIf="!loggedInAsAdminAccount" class="dropdown mx-2">
      <button class="btn btn-danger d-flex align-items-center dropdown-toggle" type="button" id="tariffDropdown"
        data-bs-toggle="dropdown" aria-expanded="false" style="border-radius: 16px; padding: 5px 10px;">
        <i class="fas fa-crown me-2"></i> 0 j.
      </button>
      <div class="dropdown-menu dropdown-menu-end p-3" aria-labelledby="tariffDropdown"
        style="width: 250px; border-radius: 8px;">
        <h6 class="text-center">Информация о тарифе</h6>
        <div class="text-center my-2">
          <i class="fas fa-exclamation-triangle text-danger" style="font-size: 24px;"></i>
        </div>
        <p class="text-center text-muted mb-2">Тариф не оплачен. Оплатите тариф для возобновления доступа к платформе.
        </p>
        <a class="btn btn-primary w-100" href="/tariffs">Перейти к тарифам</a>
      </div>
    </div> -->

    <!-- <div *ngIf="!loggedInAsAdminAccount" class="dropdown mx-2">
      <button class="btn btn-outline-dark dropdown-toggle d-flex align-items-center" type="button" id="balanceDropdown"
        data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-wallet me-2"></i> 0 EUR
      </button>
      <div class="dropdown-menu dropdown-menu-end p-3 text-center" aria-labelledby="balanceDropdown"
        style="width: 250px; border-radius: 8px;">
        <h6 class="mb-3">Баланс денежных средств</h6>
        <div class="bg-light p-3 rounded mb-3" style="font-size: 24px; color: #555;">
          0 <span style="font-size: 14px;">RUB</span>
        </div>
        <p class="text-muted mb-3">С баланса школы оплачиваются тарифы, учебники и т.д.</p>
        <button class="btn btn-primary w-100" (click)="openBalanceModal()">Пополнить баланс</button>
      </div>
    </div> -->

    <!-- Modal de rechargement de solde -->
    <!-- <div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': showBalanceModal }" role="dialog"
      style="background: rgba(0, 0, 0, 0.5);" *ngIf="showBalanceModal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Пополнить баланс</h5>
            <button type="button" class="btn-close" aria-label="Close" (click)="closeBalanceModal()"></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-3">
              <i class="fas fa-money-bag" style="font-size: 40px; color: #FFD700;"></i>
            </div>
            <p class="text-center">Введите сумму для пополнения баланса вашего аккаунта</p>
            <input type="number" [(ngModel)]="amountToTopUp" class="form-control mb-3" placeholder="0" min="0">
            <p class="text-center">RUB</p>
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" (click)="payWithCard()">Пополнить баланс</button>
          </div>
        </div>
      </div>
    </div> -->

    <!-- Modal pour l'entrée des données de la carte -->
    <!-- <div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': isPaymentModalOpen }"
      style="background-color: rgba(0, 0, 0, 0.5);" *ngIf="isPaymentModalOpen">
      <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
        <div class="modal-content p-4">
          <div class="modal-header">
            <h5 class="modal-title mt-2">Предоставление права доступа к платформе</h5> -->
            <!-- Bouton-croix pour fermer la fenêtre modale -->
            <!-- <button type="button" class="btn-close" aria-label="Close" (click)="closePaymentModal()"></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-3">
              <p class="text-primary display-4">{{ amountToTopUp | currency:'RUB':'symbol':'1.2-2' }}</p>
            </div>
            <input type="text" class="form-control mb-3" placeholder="Номер карты">
            <div class="d-flex gap-2">
              <input type="text" class="form-control" placeholder="MM / ГГ">
              <input type="text" class="form-control" placeholder="CVV">
            </div>
            <div class="form-check my-3">
              <input type="checkbox" class="form-check-input" id="sendReceipt">
              <label class="form-check-label" for="sendReceipt">Отправить квитанцию на E-mail</label>
            </div>
            <input type="email" class="form-control mb-3" placeholder="Email">
          </div>
          <div class="modal-footer d-flex flex-column gap-2">
            <button type="button" class="btn btn-primary w-100">Оплатить {{ amountToTopUp |
              currency:'RUB':'symbol':'1.2-2' }}</button>
            <button type="button" class="btn btn-warning w-100">
              Оплатить <i class="bi bi-apple"></i>
            </button>
            <button type="button" class="btn btn-dark w-100">
              Оплатить <i class="bi bi-google"></i>
            </button>
          </div>
        </div>
      </div>
    </div>  -->

    <!-- Icône de l'utilisateur -->
    <mat-menu #userMenu="matMenu">
      <!-- Options de changement de rôle -->
      <ng-container *ngIf="shouldShowSwitchTo('admin') || shouldShowSwitchTo('student') || shouldShowSwitchTo('teacher')">
        <div class="menu-section-header">
          <span class="menu-section-title">Changer de rôle</span>
        </div>
        
        <button mat-menu-item *ngIf="shouldShowSwitchTo('admin')" (click)="switchToAdmin()">
          <mat-icon class="menu-icon">admin_panel_settings</mat-icon>
          <span class="menu-label">Administrateur</span>
        </button>
        
        <button mat-menu-item *ngIf="shouldShowSwitchTo('teacher')" (click)="switchToTeacher()">
          <mat-icon class="menu-icon">person</mat-icon>
          <span class="menu-label">Enseignant</span>
        </button>
        
        <button mat-menu-item *ngIf="shouldShowSwitchTo('student')" (click)="switchToStudent()">
          <mat-icon class="menu-icon">school</mat-icon>
          <span class="menu-label">Espace Élève</span>
        </button>
        
        <mat-divider></mat-divider>
      </ng-container>
      
      <!-- Options principales -->
      <button mat-menu-item [routerLink]="settingsLink">
        <mat-icon class="menu-icon">settings</mat-icon>
        <span class="menu-label">Paramètres du profil</span>
      </button>
      <button mat-menu-item routerLink="/tariffs">
        <mat-icon class="menu-icon">star</mat-icon>
        <span class="menu-label">Tarifs</span>
      </button>
      <button mat-menu-item (click)="toggleDarkMode()">
        <mat-icon class="menu-icon">{{ isDarkMode ? 'light_mode' : 'dark_mode' }}</mat-icon>
        <span class="menu-label">{{ isDarkMode ? 'Thème clair' : 'Thème sombre' }}</span>
      </button>
      <button mat-menu-item routerLink="/logout">
        <mat-icon class="menu-icon">logout</mat-icon>
        <span class="menu-label">Déconnexion</span>
      </button>
    </mat-menu>

    <button mat-button [matMenuTriggerFor]="userMenu" class="user-button">
      <div class="user-header-icon">
        {{ authService.getUserInitial() }}
      </div>
    </button>


  </div>
</nav>


<!-- Header pour LessonMaterialComponent -->
<nav class="navbar navbar-expand-lg navbar-light bg-light" *ngIf="isLessonMaterialRoute">
  <div class="container-fluid">
    <!-- Bouton "Autre leçon" -->
    <div class="d-flex align-items-center">
      <button class="btn btn-primary me-3" (click)="navigateToLesson()">Autre leçon</button>
    </div>

    <nav class="navbar">
      <div class="navbar-nav">
        <!-- Dropdown pour les informations sur l'étape -->
        <div class="dropdown me-3" *ngIf="isLessonStarted$ | async">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton"
            data-bs-toggle="dropdown" aria-expanded="false">
            {{ (lessonDescription$ | async)?.lesson }}
          </button>
          <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <li class="dropdown-item">
              <strong>Leçon:</strong> {{ (lessonDescription$ | async)?.lesson }}
            </li>
            <li class="dropdown-item">
              <strong>Cours:</strong> {{ (lessonDescription$ | async)?.course }}
            </li>
          </ul>
        </div>
        <!-- Lien "Leçon" -->
        <a *ngIf="showTabs" href="javascript:void(0)" class="nav-link" [class.active]="activeTab === 'lesson'"
          (click)="setActiveTab('lesson')">
          Leçon
        </a>

        <!-- Lien "Devoir à la maison" -->
        <a *ngIf="showTabs" href="javascript:void(0)" class="nav-link" [class.active]="activeTab === 'homework'"
          (click)="setActiveTab('homework')">
          Devoir à la maison
        </a>
      </div>
    </nav>


    <!-- Bloc des boutons et des dropdowns -->
    <div class="d-flex align-items-center justify-content-end">
      <!-- Bouton "Ajouter des élèves" -->
      <button class="btn btn-outline-primary me-2" (click)="openStudentTabsModal()">Ajouter des élèves</button>


      <!-- Bouton "Utilisateurs" -->
      <button class="btn btn-outline-secondary me-2" (click)="openUserModal()">Utilisateurs</button>

      <!-- Dropdown pour les paramètres -->
      <div class="dropdown">
        <button class="btn btn-outline-primary dropdown-toggle" id="settingsDropdown" data-bs-toggle="dropdown"
          aria-expanded="false">
          <img [src]="classCover || 'https://via.placeholder.com/150'" alt="Paramètres"
            style="height: 32px; width: 32px; object-fit: cover;">
        </button>
        <ul class="dropdown-menu dropdown-menu-end text-start" aria-labelledby="settingsDropdown">
          <li>
            <a class="dropdown-item" href="#" (click)="openStudentListModal(); $event.preventDefault()">
              <i class="fas fa-users me-2"></i> Élèves de la classe
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#" (click)="openScheduleModal(); $event.preventDefault()">
              <i class="fas fa-calendar-alt me-2"></i> Planification des cours
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#">
              <i class="fas fa-chart-bar me-2"></i> Statistiques de la classe
            </a>
          </li>
          <li>
            <a class="dropdown-item" href="#" (click)="openClassSettingsModal(); $event.preventDefault()">
              <i class="fas fa-cogs me-2"></i> Paramètres de la classe
            </a>
          </li>
          <li>
            <hr class="dropdown-divider" />
          </li>
          <li>
            <a class="dropdown-item" href="#" (click)="toggleDarkMode(); $event.preventDefault()">
              <i class="fas {{ isDarkMode ? 'fa-sun' : 'fa-moon' }} me-2"></i> {{ isDarkMode ? 'Thème clair' : 'Thème sombre' }}
            </a>
          </li>
          <li>
            <a class="dropdown-item text-danger" (click)="openLeaveClassModal()">
              <i class="fas fa-sign-out-alt me-2"></i> Quitter la classe
            </a>
          </li>
        </ul>
      </div>

      <button class="btn btn-outline-danger ms-2" (click)="openLeaveClassModal()">
        <i class="fas fa-sign-out-alt me-2"></i>
      </button>
    </div>
  </div>
</nav>

<!-- Modal pour les utilisateurs -->
<div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': isUserModalOpen }" *ngIf="isUserModalOpen"
  style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Utilisateurs</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeUserModal()"></button>
      </div>
      <div class="modal-body">
        <div *ngFor="let user of users" class="user-card d-flex align-items-center mb-3 position-relative">
          <!-- Icône de l'utilisateur -->
          <div class="position-relative me-3">
            <div
              class="user-icon rounded-circle bg-primary text-white d-flex align-items-center justify-content-center">
              {{ user.initials }}
            </div>
            <div class="online-indicator" (mouseenter)="showTooltip(user.role)" (mouseleave)="hideTooltip()">
              <i class="fas fa-circle text-success"></i>
              <div class="tooltip" *ngIf="tooltipVisible === user.role">Élève dans la classe</div>
            </div>
          </div>

          <!-- Infobulle -->
          <div *ngIf="tooltipVisible === user.role" class="tooltip-container position-absolute">
            {{ getTooltipText(user.role) }}
          </div>

          <!-- Informations sur l'utilisateur -->
          <div>
            <p class="mb-0 fw-bold">{{ user.name }}</p>
            <p class="mb-0 text-muted small">
              <i class="fas fa-id-badge me-1"></i> {{ user.id }}
            </p>
            <p class="mb-0 text-muted small">
              <i class="fas fa-envelope me-1"></i> {{ user.email }}
            </p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" (click)="openStudentListModal()">Voir tous les élèves</button>
      </div>
    </div>
  </div>
</div>


<!-- Modal "Voir tous les élèves" -->
<div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': showStudentListModal }" *ngIf="showStudentListModal"
  style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Liste des élèves</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeStudentListModal()"></button>
      </div>
      <div class="modal-body">
        <div *ngFor="let student of allStudents" class="user-card d-flex align-items-center mb-3">
          <div class="position-relative me-3">
            <div
              class="user-icon rounded-circle bg-primary text-white d-flex align-items-center justify-content-center">
              {{ student.initials }}
            </div>
            <div class="online-indicator" *ngIf="student.online" (mouseenter)="showTooltip(student.name)"
              (mouseleave)="hideTooltip()">
              <i class="fas fa-circle text-success"></i>
              <div class="tooltip" *ngIf="tooltipVisible === student.name">Élève en ligne</div>
            </div>
          </div>
          <div>
            <p class="mb-0">{{ student.name }}</p>
            <small class="text-muted">
              <i class="fas fa-id-badge me-2"></i>{{ student.id }}
            </small>
            <br />
            <small class="text-muted">
              <i class="fas fa-envelope me-2"></i>{{ student.email }}
            </small>
          </div>
        </div>
      </div>
      <button class="btn btn-outline-primary w-100" (click)="openAddAdditionalStudentModal()">
        <i class="fas fa-plus me-2"></i> Ajouter un élève
      </button>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': showAddAdditionalStudentModal }"
  *ngIf="showAddAdditionalStudentModal" style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4">
      <!-- En-tête -->
      <div class="modal-header border-0">
        <!-- Bouton "Retour", si l'écran actif est le deuxième -->
        <button *ngIf="currentModalView === 'link'" class="btn btn-outline-secondary"
          (click)="switchModalView('default')">
          <i class="fas fa-arrow-left"></i>
        </button>
        <!-- Bouton "Fermer" -->
        <button type="button" class="btn-close" aria-label="Close" (click)="closeAddAdditionalStudentModal()"></button>
      </div>

      <div class="modal-body text-center">
        <!-- Affichage par défaut -->
        <ng-container *ngIf="currentModalView === 'default'">
          <div class="circle mx-auto mb-3" style="
              background-image: url('https://cdn.cloudstori.com/shells/words_shell/words_shell_3.1.5.15/img/Emoji-138.2e600385.png');
              width: 100px;
              height: 100px;
              background-size: cover;
              background-position: center;
              border-radius: 50%;
            "></div>
          <h5 class="modal-title fw-bold">Ajouter un élève</h5>
          <div class="d-grid gap-3 mt-4">
            <button class="btn btn-light py-2" (click)="switchModalView('link')">
              <i class="fas fa-link me-2"></i> Ajouter par lien
            </button>
            <button class="btn btn-light py-2" (click)="switchModalView('email')">
              <i class="fas fa-envelope me-2"></i> Ajouter par e-mail
            </button>
            <button (click)="switchModalView('existing')"><i class="fas fa-users me-2"></i> Choisir parmi
              existants</button>
          </div>
        </ng-container>

        <!-- Affichage "Ajouter par lien" -->
        <ng-container *ngIf="currentModalView === 'link'">
          <div class="circle mx-auto mb-3" style="
              background-image: url('https://cdn-icons-png.flaticon.com/512/847/847969.png');
              width: 80px;
              height: 80px;
              background-size: contain;
              background-repeat: no-repeat;
              background-position: center;
              border-radius: 50%;
            "></div>
          <h5 class="modal-title fw-bold">Ajouter par lien</h5>
          <div class="form-group mt-3">
            <input type="text" class="form-control text-center" readonly [value]="inviteLink" />
          </div>
          <button class="btn btn-primary mt-3" (click)="copyLink()">
            Copier le lien
          </button>
          <div class="alert alert-info mt-3 text-start" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            Envoyez ce lien à l'élève — il pourra s'inscrire ou se connecter à son compte et s'auto-inscrire à cette classe.
          </div>
        </ng-container>

        <ng-container *ngIf="currentModalView === 'email'">
          <button class="btn btn-light border-0 shadow-none position-absolute start-0 mt-2 ms-2"
            (click)="switchModalView('default')">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div class="circle mx-auto mb-3" style="
              background-image: url('https://cdn-icons-png.flaticon.com/512/561/561127.png');
              width: 80px;
              height: 80px;
              background-size: contain;
              background-repeat: no-repeat;
              background-position: center;
              border-radius: 50%;
            "></div>
          <h5 class="modal-title fw-bold">Ajouter par e-mail</h5>
          <form>
            <div class="form-group mb-3">
              <label for="studentName" class="form-label">Nom</label>
              <input type="text" class="form-control" id="studentName" placeholder="Nom de l'élève" />
            </div>
            <div class="form-group mb-3">
              <label for="studentEmail" class="form-label">E-mail</label>
              <input type="email" class="form-control" id="studentEmail" placeholder="E-mail de l'élève" />
            </div>
            <div class="form-group mb-3">
              <label for="studentPhone" class="form-label">Téléphone</label>
              <input type="tel" class="form-control" id="studentPhone" placeholder="Téléphone de l'élève" />
            </div>
            <div class="form-group mb-3">
              <label for="studentLanguage" class="form-label">Langue</label>
              <select class="form-control" id="studentLanguage">
                <option>Choisissez une langue</option>
                <option>Russe</option>
                <option>Anglais</option>
                <option>Français</option>
              </select>
            </div>
            <div class="form-group mb-3">
              <label for="studentTimezone" class="form-label">Fuseau horaire</label>
              <input type="text" class="form-control" id="studentTimezone" placeholder="07:42 (UTC-2)" />
            </div>
            <button class="btn btn-primary w-100">Ajouter</button>
          </form>
        </ng-container>
        <ng-container *ngIf="currentModalView === 'existing'">
          <button class="btn btn-light border-0 shadow-none position-absolute start-0 mt-2 ms-2"
            (click)="switchModalView('default')">
            <i class="fas fa-arrow-left"></i>
          </button>
          <div class="circle mx-auto mb-3" style="
              background-image: url('https://cdn-icons-png.flaticon.com/512/4086/4086679.png');
              width: 80px;
              height: 80px;
              background-size: contain;
              background-repeat: no-repeat;
              background-position: center;
              border-radius: 50%;
            "></div>
          <h5 class="modal-title fw-bold text-center">Choisir parmi existants</h5>
          <div class="list-group">
            <tr *ngFor="let student of getAvailableStudents()" (click)="selectStudent(student)"
              [class.selected]="selectedStudent?.id === student.id">
              <td>{{ student.name }}</td>
              <td>
                <!-- Affichage de l'icône uniquement pour l'élève sélectionné -->
                <i class="fas fa-check-circle" *ngIf="selectedStudent?.id === student.id" style="color: green;"></i>
              </td>
            </tr>
          </div>

          <div class="mt-3">
            <button class="btn btn-primary w-100" [disabled]="!selectedStudent" (click)="addSelectedStudent()">
              Ajouter l'élève
            </button>
          </div>
        </ng-container>


      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': showStudentTabsModal }" *ngIf="showStudentTabsModal"
  style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4">
      <div class="modal-header border-0">
        <h5 class="modal-title">Ajouter un élève</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeStudentTabsModal()"></button>
      </div>

      <!-- Onglets -->
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link" [ngClass]="{ active: activeTab === 'link' }" (click)="switchTab('link')">Par lien</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [ngClass]="{ active: activeTab === 'email' }" (click)="switchTab('email')">Manuellement</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [ngClass]="{ active: activeTab === 'existing' }"
            (click)="switchTab('existing')">Existant</a>
        </li>
      </ul>

      <!-- Contenu des onglets -->
      <div class="modal-body">
        <!-- Onglet "Par lien" -->
        <div *ngIf="activeTab === 'link'">
          <div class="circle mx-auto mb-3" style="
              background-image: url('https://cdn-icons-png.flaticon.com/512/847/847969.png');
              width: 80px;
              height: 80px;
              background-size: contain;
              background-repeat: no-repeat;
              background-position: center;
              border-radius: 50%;
            "></div>
          <h5 class="modal-title fw-bold">Ajouter par lien</h5>
          <input type="text" class="form-control text-center mt-3" readonly [value]="inviteLink" />
          <button class="btn btn-primary mt-3" (click)="copyLink()">Copier le lien</button>
          <div class="alert alert-info mt-3" role="alert">
            <i class="fas fa-info-circle me-2"></i>
            Envoyez ce lien à l'élève — il pourra s'inscrire ou se connecter à son compte et s'auto-inscrire à cette classe.
          </div>
        </div>

        <!-- Onglet "Manuellement" -->
        <div *ngIf="activeTab === 'email'">
          <div class="circle mx-auto mb-3" style="
              background-image: url('https://cdn-icons-png.flaticon.com/512/561/561127.png');
              width: 80px;
              height: 80px;
              background-size: contain;
              background-repeat: no-repeat;
              background-position: center;
              border-radius: 50%;
            "></div>
          <h5 class="modal-title fw-bold">Ajouter manuellement</h5>
          <form>
            <div class="mb-3">
              <label class="form-label">Nom</label>
              <input type="text" class="form-control" placeholder="Nom de l'élève" />
            </div>
            <div class="mb-3">
              <label class="form-label">E-mail</label>
              <input type="email" class="form-control" placeholder="E-mail de l'élève" />
            </div>
            <button class="btn btn-primary w-100">Ajouter</button>
          </form>
        </div>

        <!-- Onglet "Existant" -->
        <div *ngIf="activeTab === 'existing'">
          <div class="circle mx-auto mb-3" style="
              background-image: url('https://cdn-icons-png.flaticon.com/512/4086/4086679.png');
              width: 80px;
              height: 80px;
              background-size: contain;
              background-repeat: no-repeat;
              background-position: center;
              border-radius: 50%;
            "></div>
          <h5 class="modal-title fw-bold text-center">Choisir parmi existants</h5>
          <ul class="list-group">
            <li *ngFor="let student of getAvailableStudents()"
              class="list-group-item d-flex justify-content-between align-items-center" (click)="selectStudent(student)"
              [class.selected]="selectedStudent?.id === student.id">
              {{ student.name }}
              <i class="fas fa-check-circle text-success" *ngIf="selectedStudent?.id === student.id"></i>
            </li>
          </ul>
          <button class="btn btn-primary w-100 mt-3" [disabled]="!selectedStudent"
            (click)="addSelectedStudent()">Ajouter l'élève</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': showLeaveClassModal }" *ngIf="showLeaveClassModal"
  style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-center">Quitter la classe</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeLeaveClassModal()"></button>
      </div>
      <div class="modal-body text-center">
        <div class="circle mx-auto mb-3" style="
              background-color: #d9eaf7;
              color: #007bff;
              display: flex;
              align-items: center;
              justify-content: center;
              width: 80px;
              height: 80px;
              border-radius: 50%;
            ">
          <i class="fas fa-info-circle" style="font-size: 36px;"></i>
        </div>
        <p>Voulez-vous vraiment quitter la classe?</p>
      </div>
      <div class="modal-footer justify-content-between">
        <button class="btn btn-outline-secondary" (click)="closeLeaveClassModal()">Annuler</button>
        <button class="btn btn-danger" (click)="confirmLeaveClass()">Quitter</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': showClassSettingsModal }"
  *ngIf="showClassSettingsModal" style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered modal-lg position-relative">
    <div class="modal-content p-4">
      <div *ngIf="classSettingsTooltip" class="tooltip-box" [ngStyle]="tooltipPosition">
        {{ classSettingsTooltip }}
      </div>
      <div class="modal-header">
        <div class="modal-header d-flex justify-content-between align-items-center">
          <!-- Image à la place du texte "Paramètres" -->
          <img [src]="classCover || 'https://via.placeholder.com/150'" alt="Couverture de la classe" style="height: 100px;">
          <button type="button" class="btn-close" aria-label="Close" (click)="closeClassSettingsModal()"></button>
        </div>
      </div>
      <div class="modal-body">
        <form>
          <!-- Couverture -->
          <div class="row mb-3">
            <label for="classCover" class="col-4 col-form-label text-end">Couverture</label>
            <div class="col-8">
              <button class="btn btn-light" (click)="uploadFile('uploadCover')">Télécharger</button>
              <input type="file" id="uploadCover" class="d-none" (change)="onFileUpload($event, 'cover')" />
              <small class="text-muted d-block">PNG ou JPEG, jusqu'à 500x500px</small>
            </div>
          </div>


          <!-- Nom de la classe -->
          <div class="row mb-3 align-items-center">
            <label for="className" class="col-4 col-form-label text-end">Nom de la classe</label>
            <div class="col-8">
              <input type="text" id="className" class="form-control" placeholder="Entrez le nom de la classe" />
            </div>
          </div>

          <!-- Traduction rapide -->
          <div class="row mb-3 align-items-center">
            <label for="quickTranslation" class="col-4 col-form-label text-end">
              Traduction rapide
              <span class="ms-2" (mouseenter)="showClassSettingsTooltip('quickTranslation', $event)"
                (mouseleave)="hideClassSettingsTooltip()">
                <i class="fas fa-info-circle"></i>
              </span>
            </label>
            <div class="col-8">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="quickTranslationSwitch" checked />
                <label class="form-check-label" for="quickTranslationSwitch"></label>
              </div>
            </div>
          </div>

          <!-- Durée de la leçon -->
          <div class="row mb-3 align-items-center">
            <label for="lessonDuration" class="col-4 col-form-label text-end">
              Durée de la leçon
              <span class="ms-2" (mouseenter)="showClassSettingsTooltip('lessonDuration', $event)"
                (mouseleave)="hideClassSettingsTooltip()">
                <i class="fas fa-info-circle"></i>
              </span>
            </label>
            <div class="col-8">
              <select id="lessonDuration" class="form-select">
                <option>Choisissez le temps</option>
                <option>30 minutes</option>
                <option>60 minutes</option>
              </select>
            </div>
          </div>

          <div class="row mb-3">
            <label for="classBackground" class="col-4 col-form-label text-end">
              Fond de classe
            </label>
            <div class="col-8">
              <div class="d-flex gap-2 flex-wrap">
                <!-- Image 1 -->
                <div class="border p-1"
                  [ngClass]="{'selected-border': selectedBackground === 'https://media.docstorio.com/files/Groups/7a150821-adc2-405e-a328-24997ef5814d.png'}"
                  style="width: 70px; height: 70px; cursor: pointer;"
                  (click)="selectBackground('https://media.docstorio.com/files/Groups/7a150821-adc2-405e-a328-24997ef5814d.png')">
                  <img src="https://media.docstorio.com/files/Groups/7a150821-adc2-405e-a328-24997ef5814d.png"
                    alt="Image Li 7" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                <!-- Image 2 -->
                <div class="border p-1"
                  [ngClass]="{'selected-border': selectedBackground === 'https://media.docstorio.com/files/Groups/f6cac5a6-6dcd-48ff-98ad-34217e5c93fd.png'}"
                  style="width: 70px; height: 70px; cursor: pointer;"
                  (click)="selectBackground('https://media.docstorio.com/files/Groups/f6cac5a6-6dcd-48ff-98ad-34217e5c93fd.png')">
                  <img src="https://media.docstorio.com/files/Groups/f6cac5a6-6dcd-48ff-98ad-34217e5c93fd.png"
                    alt="Image Li 6" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                <!-- Image 3 -->
                <div class="border p-1"
                  [ngClass]="{'selected-border': selectedBackground === 'https://media.docstorio.com/files/Groups/fb4af339-6f53-4fcc-80c9-71988e27011e.png'}"
                  style="width: 70px; height: 70px; cursor: pointer;"
                  (click)="selectBackground('https://media.docstorio.com/files/Groups/fb4af339-6f53-4fcc-80c9-71988e27011e.png')">
                  <img src="https://media.docstorio.com/files/Groups/fb4af339-6f53-4fcc-80c9-71988e27011e.png"
                    alt="Image Li 4" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                <!-- Image 4 -->
                <div class="border p-1"
                  [ngClass]="{'selected-border': selectedBackground === 'https://media.docstorio.com/files/Groups/0cfa4cac-26e7-4910-a03f-0ed879522e87.png'}"
                  style="width: 70px; height: 70px; cursor: pointer;"
                  (click)="selectBackground('https://media.docstorio.com/files/Groups/0cfa4cac-26e7-4910-a03f-0ed879522e87.png')">
                  <img src="https://media.docstorio.com/files/Groups/0cfa4cac-26e7-4910-a03f-0ed879522e87.png"
                    alt="Image Li 3" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
                <!-- Image 5 -->
                <div class="border p-1"
                  [ngClass]="{'selected-border': selectedBackground === 'https://media.docstorio.com/files/Groups/a6da79a9-bae8-4f8d-a44f-1e75452217b8.png'}"
                  style="width: 70px; height: 70px; cursor: pointer;"
                  (click)="selectBackground('https://media.docstorio.com/files/Groups/a6da79a9-bae8-4f8d-a44f-1e75452217b8.png')">
                  <img src="https://media.docstorio.com/files/Groups/a6da79a9-bae8-4f8d-a44f-1e75452217b8.png"
                    alt="Image Li 5" style="width: 100%; height: 100%; object-fit: cover;">
                </div>
              </div>
              <button class="btn btn-light mt-2" (click)="uploadFile('uploadBackground')">Télécharger votre fond</button>
              <input type="file" id="uploadBackground" class="d-none" (change)="onFileUpload($event, 'background')" />
            </div>
          </div>

          <!-- Statistiques -->
          <div class="row mb-3 align-items-center">
            <label for="enableStats" class="col-4 col-form-label text-end">
              Statistiques
              <span class="ms-2" (mouseenter)="showClassSettingsTooltip('statistics', $event)"
                (mouseleave)="hideClassSettingsTooltip()">
                <i class="fas fa-info-circle"></i>
              </span>
            </label>
            <div class="col-8">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="enableStatsSwitch" checked />
                <label class="form-check-label" for="enableStatsSwitch"></label>
              </div>
            </div>
          </div>

          <div class="row mb-3">
            <label for="studentRating" class="col-4 col-form-label text-end">
              Note de l'élève
              <span class="ms-2" (mouseenter)="showClassSettingsTooltip('studentRating', $event)"
                (mouseleave)="hideClassSettingsTooltip()">
                <i class="fas fa-info-circle"></i>
              </span>
            </label>
            <div class="col-8">
              <div class="form-check form-switch align-self-start mb-3">
                <input class="form-check-input" type="checkbox" id="studentRatingSwitch" checked />
                <label class="form-check-label" for="studentRatingSwitch"></label>
              </div>
              <div class="row">
                <div class="col-4 d-flex align-items-center">
                  <label for="displayOption" class="col-form-label">Afficher</label>
                </div>
                <div class="col-8">
                  <select id="displayOption" class="form-select">
                    <option>Les 3 premiers élèves</option>
                    <option>Tous les élèves</option>
                  </select>
                </div>
              </div>
              <div class="row mt-2">
                <div class="col-4 d-flex align-items-center">
                  <label for="placeOption" class="col-form-label">Place de l'élève</label>
                </div>
                <div class="col-8">
                  <select id="placeOption" class="form-select">
                    <option>Afficher</option>
                    <option>Ne pas afficher</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

        </form>
      </div>
      <div class="modal-footer d-flex justify-content-center">
        <button type="button" class="btn btn-secondary" (click)="closeClassSettingsModal()">Annuler</button>
        <!-- Bouton de sauvegarde -->
        <button type="button" class="btn btn-primary" (click)="saveSettings()">Sauvegarder</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': showScheduleModal }" *ngIf="showScheduleModal"
  style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Planification des cours</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeScheduleModal()"></button>
      </div>
      <div class="modal-body">
        <app-schedule></app-schedule>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeScheduleModal()">Fermer</button>
      </div>
    </div>
  </div>
</div>
