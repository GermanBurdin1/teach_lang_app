<nav class="navbar navbar-expand-lg navbar-light bg-light" role="navigation" id="navigation">
  <!-- Skip links for keyboard navigation -->
  <a href="#main-content" class="skip-link">Aller au contenu principal</a>
  <a href="#navigation" class="skip-link">Aller à la navigation</a>
  
  <!-- Убрали старый раскрывающийся header - переместили в dropdown меню -->

  <div class="container-fluid d-flex justify-content-end align-items-center">
    <!-- Dropdown для помощи -->
    <!-- <div *ngIf="!loggedInAsAdminAccount" class="dropdown mx-2">
      <button class="btn btn-outline-primary dropdown-toggle d-flex align-items-center" type="button" id="helpDropdown"
        data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-rocket me-2"></i> Assistance
      </button>
      <div class="dropdown-menu dropdown-menu-end p-3" aria-labelledby="helpDropdown"
        style="width: 250px; border-radius: 8px;">
        <h6 class="mb-3 d-flex align-items-center">
          <i class="fas fa-school me-2 text-primary"></i> С чего начать
        </h6>
        <ul class="list-unstyled mb-0">
          <li><a class="dropdown-item" href="#" (click)="openTourModal(); $event.preventDefault()">Демо-тур</a></li>
          <li><a class="dropdown-item" href="/youtube-channel">YouTube-канал</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="/support">Техподдержка</a></li>
        </ul>
      </div>
    </div> -->

    <!-- Guided Tour Modal -->
    <!-- <div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': isTourModalOpen }"
      style="background-color: rgba(0, 0, 0, 0.5);" *ngIf="isTourModalOpen">
      <div class="modal-dialog modal-dialog-centered"
        [ngStyle]="{ position: modalPosition, top: modalTop, left: modalLeft }">
        <div class="modal-content p-4">
          <div class="modal-header">
            <h5 class="modal-title">{{ tourSteps[currentStep].title }}</h5>
            <button type="button" class="btn-close" aria-label="Close" (click)="closeTourModal()"></button>
          </div>
          <div class="modal-body">
            <p>{{ tourSteps[currentStep].content }}</p>
          </div>
          <div class="modal-footer d-flex justify-content-between">
            <div> -->
              <!-- Кнопка "Назад" видна только начиная со второго шага -->
              <!-- <button *ngIf="currentStep > 0" class="btn btn-secondary" (click)="previousStep()">Назад</button>
            </div>
            <div> -->
              <!-- Отображение текущего и общего числа шагов -->
              <!-- <span>{{ currentStep + 1 }} из {{ tourSteps.length }}</span> -->
              <!-- Кнопка "Далее" -->
              <!-- <button *ngIf="currentStep < tourSteps.length - 1" class="btn btn-primary"
                (click)="nextStep()">Далее</button> -->
              <!-- Кнопка "Завершить" на последнем шаге -->
              <!-- <button *ngIf="currentStep === tourSteps.length - 1" class="btn btn-primary"
                (click)="closeTourModal()">Завершить</button>
            </div>
          </div>
        </div>
      </div>
    </div> -->

    <!-- Dropdown для информации о тарифе -->
    <!-- <div *ngIf="!loggedInAsAdminAccount" class="dropdown mx-2">
      <button class="btn btn-danger d-flex align-items-center dropdown-toggle" type="button" id="tariffDropdown"
        data-bs-toggle="dropdown" aria-expanded="false" style="border-radius: 16px; padding: 5px 10px;">
        <i class="fas fa-crown me-2"></i> 0 j.
      </button>
      <div class="dropdown-menu dropdown-menu-end p-3" aria-labelledby="tariffDropdown"
        style="width: 250px; border-radius: 8px;">
        <h6 class="text-center">Информация о тарифе</h6>
        <div class="text-center my-2">
          <i class="fas fa-exclamation-triangle text-danger" style="font-size: 24px;"></i>
        </div>
        <p class="text-center text-muted mb-2">Тариф не оплачен. Оплатите тариф для возобновления доступа к платформе.
        </p>
        <a class="btn btn-primary w-100" href="/tariffs">Перейти к тарифам</a>
      </div>
    </div> -->

    <!-- <div *ngIf="!loggedInAsAdminAccount" class="dropdown mx-2">
      <button class="btn btn-outline-dark dropdown-toggle d-flex align-items-center" type="button" id="balanceDropdown"
        data-bs-toggle="dropdown" aria-expanded="false">
        <i class="fas fa-wallet me-2"></i> 0 EUR
      </button>
      <div class="dropdown-menu dropdown-menu-end p-3 text-center" aria-labelledby="balanceDropdown"
        style="width: 250px; border-radius: 8px;">
        <h6 class="mb-3">Баланс денежных средств</h6>
        <div class="bg-light p-3 rounded mb-3" style="font-size: 24px; color: #555;">
          0 <span style="font-size: 14px;">RUB</span>
        </div>
        <p class="text-muted mb-3">С баланса школы оплачиваются тарифы, учебники и т.д.</p>
        <button class="btn btn-primary w-100" (click)="openBalanceModal()">Пополнить баланс</button>
      </div>
    </div> -->

    <!-- Модальное окно пополнения суммы -->
    <!-- <div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': showBalanceModal }" role="dialog"
      style="background: rgba(0, 0, 0, 0.5);" *ngIf="showBalanceModal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Пополнить баланс</h5>
            <button type="button" class="btn-close" aria-label="Close" (click)="closeBalanceModal()"></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-3">
              <i class="fas fa-money-bag" style="font-size: 40px; color: #FFD700;"></i>
            </div>
            <p class="text-center">Введите сумму для пополнения баланса вашего аккаунта</p>
            <input type="number" [(ngModel)]="amountToTopUp" class="form-control mb-3" placeholder="0" min="0">
            <p class="text-center">RUB</p>
          </div>
          <div class="modal-footer">
            <button class="btn btn-primary" (click)="payWithCard()">Пополнить баланс</button>
          </div>
        </div>
      </div>
    </div> -->

    <!-- Модальное окно для ввода данных карты -->
    <!-- <div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': isPaymentModalOpen }"
      style="background-color: rgba(0, 0, 0, 0.5);" *ngIf="isPaymentModalOpen">
      <div class="modal-dialog modal-dialog-centered" (click)="$event.stopPropagation()">
        <div class="modal-content p-4">
          <div class="modal-header">
            <h5 class="modal-title mt-2">Предоставление права доступа к платформе</h5> -->
            <!-- Кнопка-крестик для закрытия модального окна -->
            <!-- <button type="button" class="btn-close" aria-label="Close" (click)="closePaymentModal()"></button>
          </div>
          <div class="modal-body">
            <div class="text-center mb-3">
              <p class="text-primary display-4">{{ amountToTopUp | currency:'RUB':'symbol':'1.2-2' }}</p>
            </div>
            <input type="text" class="form-control mb-3" placeholder="Номер карты">
            <div class="d-flex gap-2">
              <input type="text" class="form-control" placeholder="MM / ГГ">
              <input type="text" class="form-control" placeholder="CVV">
            </div>
            <div class="form-check my-3">
              <input type="checkbox" class="form-check-input" id="sendReceipt">
              <label class="form-check-label" for="sendReceipt">Отправить квитанцию на E-mail</label>
            </div>
            <input type="email" class="form-control mb-3" placeholder="Email">
          </div>
          <div class="modal-footer d-flex flex-column gap-2">
            <button type="button" class="btn btn-primary w-100">Оплатить {{ amountToTopUp |
              currency:'RUB':'symbol':'1.2-2' }}</button>
            <button type="button" class="btn btn-warning w-100">
              Оплатить <i class="bi bi-apple"></i>
            </button>
            <button type="button" class="btn btn-dark w-100">
              Оплатить <i class="bi bi-google"></i>
            </button>
          </div>
        </div>
      </div>
    </div>  -->

    <!-- Иконка пользователя -->
    <mat-menu #userMenu="matMenu">
      <!-- Опции переключения ролей -->
      <ng-container *ngIf="shouldShowSwitchTo('admin') || shouldShowSwitchTo('student') || shouldShowSwitchTo('teacher')">
        <div class="menu-section-header">
          <span class="menu-section-title">Changer de rôle</span>
        </div>
        
        <button mat-menu-item *ngIf="shouldShowSwitchTo('admin')" (click)="switchToAdmin()">
          <mat-icon class="menu-icon">admin_panel_settings</mat-icon>
          <span class="menu-label">Administrateur</span>
        </button>
        
        <button mat-menu-item *ngIf="shouldShowSwitchTo('teacher')" (click)="switchToTeacher()">
          <mat-icon class="menu-icon">person</mat-icon>
          <span class="menu-label">Enseignant</span>
        </button>
        
        <button mat-menu-item *ngIf="shouldShowSwitchTo('student')" (click)="switchToStudent()">
          <mat-icon class="menu-icon">school</mat-icon>
          <span class="menu-label">Espace Élève</span>
        </button>
        
        <mat-divider></mat-divider>
      </ng-container>
      
      <!-- Основные опции -->
      <button mat-menu-item [routerLink]="settingsLink">
        <mat-icon class="menu-icon">settings</mat-icon>
        <span class="menu-label">Paramètres du profil</span>
      </button>
      <button mat-menu-item routerLink="/tariffs">
        <mat-icon class="menu-icon">star</mat-icon>
        <span class="menu-label">Tarifs</span>
      </button>
      <button mat-menu-item (click)="toggleDarkMode()">
        <mat-icon class="menu-icon">{{ isDarkMode ? 'light_mode' : 'dark_mode' }}</mat-icon>
        <span class="menu-label">{{ isDarkMode ? 'Thème clair' : 'Thème sombre' }}</span>
      </button>
      <button mat-menu-item routerLink="/logout">
        <mat-icon class="menu-icon">logout</mat-icon>
        <span class="menu-label">Déconnexion</span>
      </button>
    </mat-menu>

    <button mat-button [matMenuTriggerFor]="userMenu" class="user-button">
      <div class="user-header-icon">
        {{ authService.getUserInitial() }}
      </div>
    </button>


  </div>
</nav>


<!-- Специальный хедер для LessonMaterialComponent удален - используется только общий хедер -->

<!-- Модальное окно для пользователей -->
<div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': isUserModalOpen }" *ngIf="isUserModalOpen"
  style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Пользователи</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeUserModal()"></button>
      </div>
      <div class="modal-body">
        <p>Здесь будет отображаться список пользователей.</p>
        <!-- Список пользователей -->
        <div *ngFor="let user of users" class="user-item d-flex align-items-center justify-content-between mb-2">
          <div class="user-info d-flex align-items-center">
            <div class="user-avatar me-2">
              {{ user.initials }}
            </div>
            <div>
              <div class="user-name">{{ user.name }}</div>
              <div class="user-email text-muted">{{ user.email }}</div>
            </div>
          </div>
          <div class="user-status">
            <span class="status-indicator" [class.online]="user.online" [class.offline]="!user.online">
              {{ user.online ? 'Онлайн' : 'Оффлайн' }}
            </span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeUserModal()">Закрыть</button>
      </div>
    </div>
  </div>
</div>

<!-- Модальное окно "Добавить учеников" -->
<div class="modal fade" tabindex="-1" [ngClass]="{ 'show d-block': showAddStudentModal }" *ngIf="showAddStudentModal"
  style="background-color: rgba(0, 0, 0, 0.5);">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Добавить учеников</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="closeAddStudentModal()"></button>
      </div>
      <div class="modal-body">
        <p>Здесь можно добавить учеников к классу.</p>
        <!-- Форма добавления учеников -->
        <form>
          <div class="mb-3">
            <label for="studentName" class="form-label">Имя ученика</label>
            <input type="text" class="form-control" id="studentName" placeholder="Введите имя ученика">
          </div>
          <div class="mb-3">
            <label for="studentEmail" class="form-label">Email ученика</label>
            <input type="email" class="form-control" id="studentEmail" placeholder="Введите email ученика">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeAddStudentModal()">Отмена</button>
        <button type="button" class="btn btn-primary">Добавить</button>
      </div>
    </div>
  </div>
</div>

<!-- Все специальные модальные окна для lesson-material удалены - используется только общий хедер -->